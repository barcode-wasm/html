<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webassembly (WASM) ã§ ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ</title>
    <!-- ============================================================
         PDFå‡ºåŠ›æ©Ÿèƒ½ç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆjsPDF + svg2pdf.jsï¼‰
         â€» Barcode.WASMã®æ©Ÿèƒ½ã§ã¯ãªãã€ç”Ÿæˆã—ãŸç”»åƒã‚’PDFåŒ–ã™ã‚‹ãŸã‚ã®å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
         â€» PNGå½¢å¼ã€SVGå½¢å¼å…±ã«PDFå‡ºåŠ›ã«å¯¾å¿œ
         ============================================================ -->
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/svg2pdf.js@2/dist/svg2pdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .main-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 3px solid #eee;
        }

        .main-tab {
            padding: 15px 30px;
            cursor: pointer;
            background: #f5f5f5;
            border: none;
            border-radius: 8px 8px 0 0;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .main-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .main-tab-content {
            display: none;
        }

        .main-tab-content.active {
            display: block;
        }


        .form-grid {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            gap: 12px;
        }

        .form-row.single {
            grid-template-columns: 1fr;
        }

        .form-row.double {
            grid-template-columns: 1fr 1fr;
        }

        .form-row.triple {
            grid-template-columns: 1fr 1fr 1fr;
        }

        .form-row.quad {
            grid-template-columns: 1fr 1fr 1fr 1fr;
        }

        .form-row.full-width {
            grid-template-columns: 1fr;
        }

        /* ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆå…¥åŠ›è¡Œï¼ˆã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒ©ãƒ™ãƒ«æ–¹å¼ï¼‰ */
        .compact-row {
            display: flex;
            flex-wrap: wrap;
            gap: 12px 20px;
            align-items: center;
        }

        .compact-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .compact-item label {
            margin: 0;
            font-size: 0.85em;
            white-space: nowrap;
            min-width: auto;
        }

        .compact-item input[type="number"] {
            width: 70px;
            padding: 6px 8px;
            font-size: 0.9em;
        }

        .compact-item input[type="number"].wide {
            width: 90px;
        }

        .compact-item .color-input-group {
            display: flex;
            gap: 4px;
            align-items: center;
        }

        .compact-item .color-input-group input[type="color"] {
            width: 28px;
            height: 28px;
            padding: 0;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .compact-item .color-input-group input[type="text"] {
            width: 70px;
            padding: 4px 6px;
            font-size: 0.8em;
        }

        /* å¹…ã®ä¸‹ã«ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’é…ç½®ã™ã‚‹ãŸã‚ã®å…¥ã‚Œå­æ§‹é€  */
        .compact-item-with-sub {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .compact-item-with-sub .compact-checkbox {
            margin-left: 30px;
        }

        .compact-checkbox {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.85em;
            color: #555;
        }

        .compact-checkbox input[type="checkbox"] {
            width: 15px;
            height: 15px;
        }

        .compact-checkbox label {
            margin: 0;
            font-weight: normal;
            font-size: 0.85em;
        }

        /* ã‚»ã‚¯ã‚·ãƒ§ãƒ³åŒºåˆ‡ã‚Š */
        .form-section {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .form-section:last-child {
            border-bottom: none;
        }

        .section-title {
            font-size: 0.8em;
            color: #888;
            margin-bottom: 6px;
            font-weight: 600;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.inline {
            flex-direction: row;
            align-items: center;
            gap: 10px;
        }

        label {
            font-weight: 600;
            margin-bottom: 6px;
            color: #555;
            font-size: 0.9em;
        }

        input[type="text"],
        input[type="number"],
        select {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .color-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        input[type="color"] {
            width: 60px;
            height: 40px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        button.generate-btn {
            padding: 16px 32px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        /* ç”Ÿæˆãƒœã‚¿ãƒ³ã¨å‡ºåŠ›ãƒ¢ãƒ¼ãƒ‰é¸æŠã‚’æ¨ªä¸¦ã³ã«ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠ */
        .generate-row {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .generate-row .rotate-select {
            margin-left: auto;  /* å³ç«¯ã«é…ç½® */
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .generate-row .rotate-select label {
            margin: 0;
            font-size: 0.9em;
        }

        .generate-row .rotate-select select {
            padding: 6px 10px;
            font-size: 0.9em;
        }

        /* å‡ºåŠ›ãƒ¢ãƒ¼ãƒ‰é¸æŠ */
        .output-mode-select {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .output-mode-select .mode-label {
            color: #555;
            font-weight: 600;
            margin: 0;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            height: 22px;
        }

        .output-mode-select .radio-option {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            height: 22px;
        }

        .output-mode-select input[type="radio"] {
            width: 16px;
            height: 16px;
            margin: 0;
            cursor: pointer;
        }

        .output-mode-select .radio-option span {
            color: #555;
            font-size: 0.9em;
        }

        /* PDFåŸ‹ã‚è¾¼ã¿è¡¨ç¤ºç”¨ */
        #result iframe {
            border: 2px solid #9c27b0;
            border-radius: 8px;
            background: white;
        }

        button.generate-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        button.generate-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* #resultç›´ä¸‹ã®ç”»åƒã®ã¿ï¼ˆã‚­ãƒ£ãƒ³ãƒã‚¹é…ç½®æ–¹å¼ä»¥å¤–ç”¨ï¼‰ */
        #result > img {
            max-width: 100%;
            height: auto;
        }

        #result {
            margin-top: 40px;
            text-align: center;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 12px;
            min-height: 250px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* SVGè¡¨ç¤ºç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        #result .svg-container {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 2px solid #4caf50;
        }

        #result .svg-container svg {
            max-width: 100%;
            height: auto;
        }

        .loading {
            color: #667eea;
            font-size: 1.2em;
        }

        .error {
            color: #e74c3c;
            font-size: 1.1em;
            padding: 20px;
            background: #ffe5e5;
            border-radius: 8px;
        }

        .specific-props {
            margin-top: 20px;
            padding: 20px;
            background: #fff3cd;
            border-radius: 8px;
            border-left: 4px solid #ffc107;
        }

        .specific-props h3 {
            margin-bottom: 15px;
            color: #856404;
        }

        /* å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé¸æŠUI */
        .output-format-group {
            display: flex;
            gap: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border-radius: 8px;
            border-left: 4px solid #4caf50;
            align-items: center;
        }

        .output-format-group label.format-label {
            font-weight: 600;
            color: #2e7d32;
            margin-bottom: 0;
            margin-right: 10px;
        }

        .output-format-group .radio-option {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
        }

        .output-format-group input[type="radio"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .output-format-group .radio-option span {
            font-size: 0.95em;
            color: #333;
        }

        .format-hint {
            font-size: 0.85em;
            color: #666;
            margin-left: auto;
        }

        /* å›è»¢é¸æŠUI */
        .rotate-select {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .rotate-select label {
            font-weight: 600;
            color: #555;
            font-size: 0.9em;
            margin: 0;
        }

        .rotate-select select {
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 0.9em;
            cursor: pointer;
        }

        /* ã‚­ãƒ£ãƒ³ãƒã‚¹è¡¨ç¤ºã‚¨ãƒªã‚¢ */
        .canvas-container {
            width: 100%;
            max-width: 1200px;
            height: 600px;
            background: white;
            border: 2px solid #667eea;
            border-radius: 8px;
            position: relative;
            overflow: auto;
            margin: 0 auto;
        }

        .canvas-inner {
            width: 1200px;
            height: 1000px;
            position: relative;
            background: white;
        }

        .barcode-element {
            position: absolute;
            transform-origin: left bottom;  /* å·¦ä¸‹ã‚’å›è»¢è»¸ã« */
        }

        .barcode-element img,
        .barcode-element svg {
            display: block;
            border: none !important;
            box-shadow: none !important;
            outline: none !important;
            border-radius: 0 !important;
            padding: 0 !important;
        }

        /* ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ï¼ˆã‚­ãƒ£ãƒ³ãƒã‚¹ä¸Šéƒ¨ï¼‰ */
        .toolbar {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            padding: 10px 15px;
            background: #f0f0f0;
            border-radius: 8px;
            flex-wrap: wrap;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }
        .format-label {
            font-weight: bold;
            font-size: 0.95em;
        }
        .format-label.svg { color: #4caf50; }
        .format-label.png { color: #2196F3; }
        .info-text {
            font-size: 0.85em;
            color: #666;
            margin-left: auto;
            font-family: monospace;
        }
        /* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒãƒ¼ï¼ˆä¸‹éƒ¨ãƒœã‚¿ãƒ³ç¾¤ï¼‰ */
        .action-bar {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }
        .action-btn {
            display: inline-block;
            padding: 10px 20px;
            color: white;
            text-decoration: none;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            font-size: 0.95em;
            cursor: pointer;
        }
        .action-btn:hover {
            opacity: 0.9;
        }
        .action-btn.download { background: #28a745; }
        .action-btn.open-tab { background: #667eea; }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            h1 {
                font-size: 2em;
            }
            .form-grid {
                grid-template-columns: 1fr;
            }
            .output-format-group {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            .format-hint {
                margin-left: 0;
            }
        }

        /* åˆ¶å¾¡æ–‡å­—UIã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .control-char-ui {
            background: #f8f9ff;
            padding: 10px 15px;
            border-radius: 6px;
            border-left: 3px solid #667eea;
            margin-bottom: 15px;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”² Barcode.WASM ãƒ‡ãƒ¢</h1>
        <p class="subtitle">Webassembly(WASM)ã§é«˜ç²¾åº¦ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ - PNG/SVGå‡ºåŠ›å¯¾å¿œ</p>

        <!-- â˜… å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé¸æŠï¼ˆPNG/SVGï¼‰â˜… - ã‚¿ãƒ–ã®ä¸Šã«é…ç½® -->
        <div class="output-format-group" style="margin-bottom: 20px;">
            <label class="format-label">ğŸ–¼ï¸ å‡ºåŠ›å½¢å¼:</label>
            <label class="radio-option">
                <input type="radio" name="outputFormat" value="png" checked>
                <span>PNGç”»åƒï¼ˆãƒ©ã‚¹ã‚¿ãƒ¼ï¼‰</span>
            </label>
            <label class="radio-option">
                <input type="radio" name="outputFormat" value="svg">
                <span>SVGãƒ™ã‚¯ã‚¿ãƒ¼ï¼ˆæ‹¡å¤§åŠ£åŒ–ãªã—ï¼‰</span>
            </label>
            <span class="format-hint">â€»SVGã¯å°åˆ·ãƒ»æ‹¡å¤§ã«æœ€é©</span>
        </div>

        <div class="main-tabs">
            <button class="main-tab active" onclick="switchMainTab('1d')">1æ¬¡å…ƒãƒãƒ¼ã‚³ãƒ¼ãƒ‰</button>
            <button class="main-tab" onclick="switchMainTab('2d')">2æ¬¡å…ƒãƒãƒ¼ã‚³ãƒ¼ãƒ‰</button>
            <button class="main-tab" onclick="switchMainTab('special')">ç‰¹æ®Šãƒãƒ¼ã‚³ãƒ¼ãƒ‰</button>
        </div>

        <!-- ========== 1æ¬¡å…ƒãƒãƒ¼ã‚³ãƒ¼ãƒ‰ ========== -->
        <div id="1d-content" class="main-tab-content active">
            <div class="form-grid">
                <!-- è¡Œ1: ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç¨®é¡ -->
                <div class="form-row single">
                    <div class="form-group">
                        <label for="barcode1dType">ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç¨®é¡ *</label>
                        <select id="barcode1dType" onchange="update1DProps()">
                            <option value="Code39">CODE 39</option>
                            <option value="Code93">CODE 93</option>
                            <option value="Code128">CODE 128</option>
                            <option value="GS1_128">GS1-128</option>
                            <option value="NW7">NW-7 (Codabar)</option>
                            <option value="Matrix2of5">Matrix 2 of 5</option>
                            <option value="NEC2of5">NEC 2 of 5</option>
                            <option value="Jan8">JAN-8</option>
                            <option value="Jan13">JAN-13</option>
                            <option value="UPC_A">UPC-A</option>
                            <option value="UPC_E">UPC-E</option>
                            <option value="GS1DataBar14">GS1 DataBar æ¨™æº–å‹</option>
                            <option value="GS1DataBarLimited">GS1 DataBar é™å®šå‹</option>
                            <option value="GS1DataBarExpanded">GS1 DataBar æ‹¡å¼µå‹</option>
                        </select>
                    </div>
                </div>

                <!-- è¡Œ2: ãƒ’ãƒ³ãƒˆ + ãƒ‡ãƒ¼ã‚¿å…¥åŠ› -->
                <div class="form-row full-width">
                    <div class="form-group">
                        <label for="data1d">ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ *</label>
                        <div id="barcodeHint" style="font-size: 0.85em; color: #666; margin-bottom: 5px; padding: 8px 12px; background: #f0f8ff; border-left: 4px solid #4a90e2; border-radius: 4px;">
                            åŠè§’è‹±æ•°å­—ãƒ»è¨˜å·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„
                        </div>
                        <input type="text" id="data1d" placeholder="ä¾‹: 1234567890" value="HELLO123">
                    </div>
                </div>

                <!-- åˆ¶å¾¡æ–‡å­—å…¥åŠ›UIï¼ˆCODE128é¸æŠæ™‚ã®ã¿è¡¨ç¤ºï¼‰ -->
                <div id="controlCharUI" class="control-char-ui" style="display: none;">
                    <div style="display: flex; justify-content: flex-end; align-items: center; gap: 8px;">
                        <select id="controlCharSelect" style="width: 300px; padding: 8px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 0.9em;">
                            <option value="">åˆ¶å¾¡æ–‡å­—ã‚’æŒ¿å…¥...</option>
                            <optgroup label="ã‚ˆãä½¿ã†">
                                <option value="{CR}">CR (0x0D) - å¾©å¸°</option>
                                <option value="{LF}">LF (0x0A) - æ”¹è¡Œ</option>
                                <option value="{HT}">HT (0x09) - æ°´å¹³ã‚¿ãƒ–</option>
                                <option value="{ESC}">ESC (0x1B) - ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—</option>
                                <option value="{STX}">STX (0x02) - ãƒ†ã‚­ã‚¹ãƒˆé–‹å§‹</option>
                                <option value="{ETX}">ETX (0x03) - ãƒ†ã‚­ã‚¹ãƒˆçµ‚äº†</option>
                            </optgroup>
                            <optgroup label="ãã®ä»–">
                                <option value="{NUL}">NUL (0x00) - nullæ–‡å­—</option>
                                <option value="{SOH}">SOH (0x01) - ãƒ˜ãƒƒãƒ€é–‹å§‹</option>
                                <option value="{EOT}">EOT (0x04) - è»¢é€çµ‚äº†</option>
                                <option value="{ENQ}">ENQ (0x05) - ç…§ä¼š</option>
                                <option value="{ACK}">ACK (0x06) - å—ä¿¡OK</option>
                                <option value="{BEL}">BEL (0x07) - è­¦å‘Š</option>
                                <option value="{BS}">BS (0x08) - å¾Œé€€</option>
                                <option value="{VT}">VT (0x0B) - å‚ç›´ã‚¿ãƒ–</option>
                                <option value="{FF}">FF (0x0C) - æ”¹é </option>
                                <option value="{SO}">SO (0x0E) - ã‚·ãƒ•ãƒˆã‚¢ã‚¦ãƒˆ</option>
                                <option value="{SI}">SI (0x0F) - ã‚·ãƒ•ãƒˆã‚¤ãƒ³</option>
                                <option value="{DLE}">DLE (0x10) - ãƒ‡ãƒ¼ã‚¿ãƒªãƒ³ã‚¯ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—</option>
                                <option value="{DC1}">DC1 (0x11) - è£…ç½®åˆ¶å¾¡1</option>
                                <option value="{DC2}">DC2 (0x12) - è£…ç½®åˆ¶å¾¡2</option>
                                <option value="{DC3}">DC3 (0x13) - è£…ç½®åˆ¶å¾¡3</option>
                                <option value="{DC4}">DC4 (0x14) - è£…ç½®åˆ¶å¾¡4</option>
                                <option value="{NAK}">NAK (0x15) - å—ä¿¡å¤±æ•—</option>
                                <option value="{SYN}">SYN (0x16) - åŒæœŸ</option>
                                <option value="{ETB}">ETB (0x17) - ãƒ–ãƒ­ãƒƒã‚¯çµ‚äº†</option>
                                <option value="{CAN}">CAN (0x18) - å–æ¶ˆ</option>
                                <option value="{EM}">EM (0x19) - åª’ä½“çµ‚äº†</option>
                                <option value="{SUB}">SUB (0x1A) - ç½®æ›</option>
                                <option value="{FS}">FS (0x1C) - ãƒ•ã‚¡ã‚¤ãƒ«åŒºåˆ‡ã‚Š</option>
                                <option value="{GS}">GS (0x1D) - ã‚°ãƒ«ãƒ¼ãƒ—åŒºåˆ‡ã‚Š</option>
                                <option value="{RS}">RS (0x1E) - ãƒ¬ã‚³ãƒ¼ãƒ‰åŒºåˆ‡ã‚Š</option>
                                <option value="{US}">US (0x1F) - ãƒ¦ãƒ‹ãƒƒãƒˆåŒºåˆ‡ã‚Š</option>
                            </optgroup>
                        </select>
                        <button onclick="insertControlChar()" style="padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9em;">â¬† æŒ¿å…¥</button>
                    </div>
                </div>

                <!-- GS1ç³»å…¥åŠ›è£œåŠ©UIï¼ˆGS1-128, DataBarç­‰é¸æŠæ™‚ã®ã¿è¡¨ç¤ºï¼‰ -->
                <div id="gs1AssistUI" class="control-char-ui" style="display: none;">
                    <div style="display: flex; justify-content: flex-end; align-items: center; gap: 8px;">
                        <!-- GS1-128å°‚ç”¨ -->
                        <select id="gs1PatternSelect_GS1_128" class="gs1-pattern-select" onchange="applyGS1Pattern()" style="width: 100%; max-width: 600px; padding: 8px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 0.9em; display: none;">
                            <option value="">GS1-128 ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¿ãƒ¼ãƒ³å…¥åŠ›è£œåŠ©...</option>
                            <optgroup label="åŸºæœ¬ãƒ‘ã‚¿ãƒ¼ãƒ³">
                                <option value="{FNC1}0100012345678905{AI}10ABC123">{FNC1}(01)å•†å“è­˜åˆ¥ + {AI}(10)ãƒãƒƒãƒ: (01)00012345678905(10)ABC123</option>
                                <option value="{FNC1}0100012345678905{FNC1}17251231">{FNC1}(01)å•†å“è­˜åˆ¥ + {FNC1}(17)æœ‰åŠ¹æœŸé™: (01)00012345678905(17)251231</option>
                                <option value="{FNC1}0100012345678905{FNC1}21SERIAL123">{FNC1}(01)å•†å“è­˜åˆ¥ + {FNC1}(21)ã‚·ãƒªã‚¢ãƒ«: (01)00012345678905(21)SERIAL123</option>
                                <option value="{FNC1}01000123456789051511250031001234">{FNC1}(01)å•†å“è­˜åˆ¥ + (15)æœŸé™ + (30)æ•°é‡: (01)00012345678905(15)112500(30)001234</option>
                            </optgroup>
                            <optgroup label="è¨ˆé‡å•†å“ï¼ˆé‡é‡ãƒ»ä¾¡æ ¼ï¼‰">
                                <option value="{FNC1}01900123456789083103001750">{FNC1}(01) + (3103)é‡é‡kg(0.001): (01)90012345678908(3103)001750</option>
                                <option value="{FNC1}01900123456789083202000156">{FNC1}(01) + (3202)é‡é‡lb(0.01): (01)90012345678908(3202)000156</option>
                                <option value="{FNC1}01900123456789083203022767">{FNC1}(01) + (3203)é‡é‡lb(0.001): (01)90012345678908(3203)022767</option>
                                <option value="{FNC1}0190012345678908392207950">{FNC1}(01) + (3922)ä¾¡æ ¼: (01)90012345678908(3922)07950</option>
                            </optgroup>
                            <optgroup label="è¨ˆé‡å•†å“+æ—¥ä»˜">
                                <option value="{FNC1}0190012345678908310301223311991231">{FNC1}(01) + (3103)é‡é‡ + (11)è£½é€ å¹´æœˆæ—¥</option>
                                <option value="{FNC1}0190012345678908310301223313991231">{FNC1}(01) + (3103)é‡é‡ + (13)åŒ…è£…å¹´æœˆæ—¥</option>
                                <option value="{FNC1}0190012345678908310301223315991231">{FNC1}(01) + (3103)é‡é‡ + (15)å“è³ªä¿æŒæœŸé™</option>
                                <option value="{FNC1}0190012345678908310301223317991231">{FNC1}(01) + (3103)é‡é‡ + (17)æœ‰åŠ¹æœŸé™</option>
                            </optgroup>
                        </select>

                        <!-- æ¨™æº–æ–™é‡‘ä»£ç†åç´ç”¨ã‚³ãƒ³ãƒ“ãƒ‹ãƒãƒ¼ã‚³ãƒ¼ãƒ‰å°‚ç”¨ -->
                        <select id="gs1PatternSelect_ConvenienceStore" class="gs1-pattern-select" onchange="applyGS1Pattern()" style="width: 100%; max-width: 600px; padding: 8px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 0.9em; display: none;">
                            <option value="">ã‚³ãƒ³ãƒ“ãƒ‹ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰...</option>
                            <optgroup label="æ–™é‡‘åç´ï¼ˆ91: æ¨™æº–æ–™é‡‘ä»£ç†åç´ï¼‰">
                                <option value="{FNC1}9191234500000000000000452087500401310029500">é›»æ°—æ–™é‡‘ä¾‹: 91-91234500000000000000452087500401310029500</option>
                                <option value="{FNC1}9100000000000000000000100000000000000000001">æœ€å°ä¾‹: 91-0...0-100å††-0...0-1</option>
                            </optgroup>
                            <optgroup label="æ‰•è¾¼ç¥¨ï¼ˆ91: EAN-128æ‰•è¾¼ç¥¨ï¼‰">
                                <option value="{FNC1}9112345678901234567890123456789012345678901">æ‰•è¾¼ç¥¨ä¾‹1: 91-123456789012345678901234567890123456789-01</option>
                                <option value="{FNC1}9198765432109876543210987654321098765432100">æ‰•è¾¼ç¥¨ä¾‹2: 91-987654321098765432109876543210987654321-00</option>
                            </optgroup>
                        </select>

                        <!-- GS1-DataBaræ¨™æº–å‹å°‚ç”¨ï¼ˆ14æ¡GTINã®ã¿ã€{FNC1}/{AI}ãªã—ï¼‰ -->
                        <select id="gs1PatternSelect_GS1DataBar14" class="gs1-pattern-select" onchange="applyGS1Pattern()" style="width: 100%; max-width: 600px; padding: 8px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 0.9em; display: none;">
                            <option value="">GS1 DataBar æ¨™æº–å‹ ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰...</option>
                            <option value="12345678">GTIN-8ä¾‹: 12345678 (8æ¡)</option>
                            <option value="123456789012">GTIN-12ä¾‹: 123456789012 (12æ¡ã€UPC-A)</option>
                            <option value="1234567890128">GTIN-13ä¾‹1: 1234567890128 (13æ¡ã€EAN-13)</option>
                            <option value="4912345678904">GTIN-13ä¾‹2: 4912345678904 (13æ¡ã€JAN-13)</option>
                            <option value="614141123452">çŸ­ç¸®ä¾‹: 614141123452 (12æ¡)</option>
                        </select>

                        <!-- GS1-DataBaré™å®šå‹å°‚ç”¨ï¼ˆ14æ¡GTINã€å…ˆé ­0/1ã®ã¿ã€{FNC1}/{AI}ãªã—ï¼‰ -->
                        <select id="gs1PatternSelect_GS1DataBarLimited" class="gs1-pattern-select" onchange="applyGS1Pattern()" style="width: 100%; max-width: 600px; padding: 8px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 0.9em; display: none;">
                            <option value="">GS1 DataBar é™å®šå‹ ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰...</option>
                            <option value="0123456789012">å…ˆé ­0ä¾‹1: 01234567890128 (13æ¡)</option>
                            <option value="0491234567890">å…ˆé ­0ä¾‹2: 04912345678904 (13æ¡)</option>
                            <option value="1012345678901">å…ˆé ­1ä¾‹1: 10123456789012 (13æ¡)</option>
                            <option value="1490123456789">å…ˆé ­1ä¾‹2: 14901234567897 (13æ¡)</option>
                            <option value="123456789012">çŸ­ç¸®ä¾‹1: 123456789012 (12æ¡â†’ã‚¼ãƒ­ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°å¾Œ01234567890120)</option>
                            <option value="1234567890">çŸ­ç¸®ä¾‹2: 1234567890 (10æ¡â†’ã‚¼ãƒ­ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°å¾Œ0001234567890)</option>
                        </select>
                        
                        <!-- GS1-DataBaræ‹¡å¼µå‹å°‚ç”¨ -->
                        <select id="gs1PatternSelect_GS1DataBarExpanded" class="gs1-pattern-select" onchange="applyGS1Pattern()" style="width: 100%; max-width: 600px; padding: 8px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 0.9em; display: none;">
                            <option value="">GS1 DataBar æ‹¡å¼µå‹ ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¿ãƒ¼ãƒ³å…¥åŠ›è£œåŠ©...</option>
                            <optgroup label="åŸºæœ¬ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆ{AI}ä½¿ç”¨ï¼‰">
                                <option value="0100012345678905{AI}10ABC123">(01)å•†å“è­˜åˆ¥ + {AI}(10)ãƒãƒƒãƒ: (01)00012345678905(10)ABC123</option>
                                <option value="0100012345678905{AI}21SERIAL123">(01)å•†å“è­˜åˆ¥ + {AI}(21)ã‚·ãƒªã‚¢ãƒ«: (01)00012345678905(21)SERIAL123</option>
                                <option value="123{AI}17ABCDEFGH">AIãªã— or ä»»æ„AIï¼ˆé01ï¼‰: 123(17)ABCDEFGH</option>
                            </optgroup>
                            <optgroup label="è¨ˆé‡å•†å“">
                                <option value="0190012345678908{AI}3103001750">(01) + (3103)é‡é‡kg: (01)90012345678908(3103)001750</option>
                                <option value="0190012345678908{AI}3202000156">(01) + (3202)é‡é‡lb: (01)90012345678908(3202)000156</option>
                            </optgroup>
                        </select>

                        <!-- éƒµä¾¿ã‚«ã‚¹ã‚¿ãƒãƒãƒ¼ã‚³ãƒ¼ãƒ‰å°‚ç”¨ -->
                        <select id="gs1PatternSelect_YubinCustomer" class="gs1-pattern-select" onchange="applyGS1Pattern()" style="width: 100%; max-width: 600px; padding: 8px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 0.9em; display: none;">
                            <option value="">éƒµä¾¿ã‚«ã‚¹ã‚¿ãƒãƒãƒ¼ã‚³ãƒ¼ãƒ‰ ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰...</option>
                            <optgroup label="éƒµä¾¿ç•ªå·+ä½æ‰€è¡¨ç¤ºç•ªå·">
                                <option value="27500263-29-2-401">ä¾‹1: 275-0026 + 3-29-2-401</option>
                                <option value="1638001-2-10-10-204">ä¾‹2: 163-8001 + 2-10-10-204ï¼ˆæ–°å®¿åŒºå½¹æ‰€ï¼‰</option>
                                <option value="1050011-1-1">ä¾‹3: 105-0011 + 1-1ï¼ˆèŠå…¬åœ’ï¼‰</option>
                                <option value="6000000">ä¾‹4: 600-0000ï¼ˆéƒµä¾¿ç•ªå·ã®ã¿ï¼‰</option>
                            </optgroup>
                            <optgroup label="ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆèª¬æ˜">
                                <option value="" disabled>éƒµä¾¿ç•ªå·7æ¡ + ãƒã‚¤ãƒ•ãƒ³ + ä½æ‰€è¡¨ç¤ºç•ªå·</option>
                                <option value="" disabled>ä½æ‰€è¡¨ç¤ºç•ªå·: ç”ºåŸŸå-ä¸ç›®-ç•ªåœ°-å·-å»ºç‰©ç•ªå·</option>
                            </optgroup>
                        </select>
                    </div>
                </div>

                <!-- DataBar14 ã‚¿ã‚¤ãƒ—é¸æŠï¼ˆGS1DataBar14é¸æŠæ™‚ã®ã¿è¡¨ç¤ºï¼‰ -->
                <div class="form-row single" id="grp_typeDatabar14" style="display: none;">
                    <div class="form-group">
                        <label for="typeDatabar14">DataBar æ¨™æº–å‹ ã‚¿ã‚¤ãƒ—</label>
                        <select id="typeDatabar14">
                            <option value="OMNIDIRECTIONAL">æ¨™æº–å‹ Omni-directional</option>
                            <option value="STACKED">äºŒå±¤å‹ Stacked</option>
                            <option value="STACKED_OMNIDIRECTIONAL">æ¨™æº–äºŒå±¤å‹ Stacked Omni-directional</option>
                        </select>
                    </div>
                </div>

                <!-- DataBarExpanded ã‚¿ã‚¤ãƒ—é¸æŠï¼ˆGS1DataBarExpandedé¸æŠæ™‚ã®ã¿è¡¨ç¤ºï¼‰ -->
                <div class="form-row single" id="grp_typeDatabarExpanded" style="display: none;">
                    <div class="form-group">
                        <label for="typeDatabarExpanded">DataBar æ‹¡å¼µå‹ ã‚¿ã‚¤ãƒ—</label>
                        <select id="typeDatabarExpanded" onchange="updateDataBarExpandedFontScale()">
                            <option value="UNSTACKED">ä¸€å±¤å‹ UnStacked</option>
                            <option value="STACKED">å¤šå±¤å‹ Stacked</option>
                        </select>
                    </div>
                </div>

                <!-- ä½ç½®ãƒ»ã‚µã‚¤ã‚ºè¨­å®šï¼ˆ1è¡Œã«ã¾ã¨ã‚ã‚‹ï¼‰ -->
                <div class="form-section">
                    <div class="compact-row">
                        <div class="compact-item">
                            <label for="x1d">Xåº§æ¨™</label>
                            <input type="number" id="x1d" value="20" min="0" max="1000">
                        </div>
                        <div class="compact-item">
                            <label for="y1d">Yåº§æ¨™</label>
                            <input type="number" id="y1d" value="20" min="0" max="1000">
                        </div>
                        <div class="compact-item" id="grp_width1d">
                            <label for="width1d">å¹…</label>
                            <input type="number" id="width1d" value="400" min="100" max="2000" class="wide">
                        </div>
                        <div class="compact-item" id="grp_height1d">
                            <label for="height1d">é«˜ã•</label>
                            <input type="number" id="height1d" value="150" min="50" max="500">
                        </div>
                        <div class="compact-checkbox" id="grp_fitWidth1d" style="margin-left: 10px;">
                            <input type="checkbox" id="fitWidth1d" checked>
                            <label for="fitWidth1d">å¹…ã´ã£ãŸã‚Šï¼ˆå°æ•°pxï¼‰</label>
                        </div>
                    </div>
                </div>

                <!-- è‰²è¨­å®šï¼ˆ1è¡Œã«ã¾ã¨ã‚ã‚‹ï¼‰ -->
                <div class="form-section">
                    <div class="compact-row">
                        <div class="compact-item">
                            <label for="foreColor1d">å‰æ™¯è‰²</label>
                            <div class="color-input-group">
                                <input type="color" id="foreColor1d" value="#000000">
                                <input type="text" id="foreColorText1d" value="#000000" readonly>
                            </div>
                        </div>
                        <div class="compact-item">
                            <label for="backColor1d">èƒŒæ™¯è‰²</label>
                            <div class="color-input-group">
                                <input type="color" id="backColor1d" value="#ffffff">
                                <input type="text" id="backColorText1d" value="#ffffff" readonly>
                            </div>
                        </div>
                        <div class="compact-item">
                            <label for="pxAdjustBlack1d">é»’ãƒãƒ¼èª¿æ•´</label>
                            <input type="number" id="pxAdjustBlack1d" value="0" min="-10" max="10">
                        </div>
                        <div class="compact-item">
                            <label for="pxAdjustWhite1d">ç™½èª¿æ•´</label>
                            <input type="number" id="pxAdjustWhite1d" value="0" min="-10" max="10">
                        </div>
                    </div>
                </div>

                <!-- ãƒ†ã‚­ã‚¹ãƒˆè¨­å®šï¼ˆ1è¡Œã«ã¾ã¨ã‚ã‚‹ï¼‰ -->
                <div class="form-section" id="grp_checkboxes1d">
                    <div class="compact-row" id="grp_textSettings1d">
                        <div class="compact-checkbox" id="grp_showText1d">
                            <input type="checkbox" id="showText1d" checked>
                            <label for="showText1d">ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º</label>
                        </div>
                        <div class="compact-item" id="grp_textFontScale1d">
                            <label for="textFontScale1d">ã‚µã‚¤ã‚ºå€ç‡</label>
                            <input type="number" id="textFontScale1d" value="1.0" min="0.5" max="3.0" step="0.1">
                        </div>
                        <div class="compact-item" id="grp_textGap1d">
                            <label for="textGap1d">éš™é–“</label>
                            <input type="number" id="textGap1d" value="1.0" min="0.0" max="3.0" step="0.1">
                        </div>
                    </div>
                </div>
            </div>

            <!-- å›ºæœ‰ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ -->
            <div id="specificProps1d" class="specific-props" style="display: none;">
                <h3 id="specificPropsTitle1d">å›ºæœ‰ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£</h3>
                <div id="specificPropsContent1d" class="form-grid"></div>
            </div>

            <!-- ç”Ÿæˆãƒœã‚¿ãƒ³ã¨å‡ºåŠ›ãƒ¢ãƒ¼ãƒ‰é¸æŠ -->
            <div class="generate-row">
                <button class="generate-btn" onclick="generate1D()">1æ¬¡å…ƒãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ</button>
                <div class="output-mode-select">
                    <span class="mode-label">å‡ºåŠ›:</span>
                    <label class="radio-option">
                        <input type="radio" name="outputMode1d" value="browser" checked>
                        <span>ãƒ–ãƒ©ã‚¦ã‚¶</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="outputMode1d" value="pdf">
                        <span>PDF</span>
                    </label>
                </div>
                <div class="rotate-select">
                    <label for="rotateAngle1d">ğŸ”„ å›è»¢:</label>
                    <select id="rotateAngle1d">
                        <option value="0">0Â°</option>
                        <option value="90">90Â°</option>
                        <option value="180">180Â°</option>
                        <option value="270">270Â°</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- ========== 2æ¬¡å…ƒãƒãƒ¼ã‚³ãƒ¼ãƒ‰ ========== -->
        <div id="2d-content" class="main-tab-content">
            <div class="form-grid">
                <!-- ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç¨®é¡ -->
                <div class="form-row single">
                    <div class="form-group">
                        <label for="barcode2dType">ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç¨®é¡ *</label>
                        <select id="barcode2dType" onchange="update2DProps()">
                            <option value="QR">QRã‚³ãƒ¼ãƒ‰</option>
                            <option value="DataMatrix">DataMatrix</option>
                            <option value="PDF417">PDF417</option>
                        </select>
                    </div>
                </div>

                <!-- ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ -->
                <div class="form-row single">
                    <div class="form-group">
                        <label for="data2d">ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ *</label>
                        <input type="text" id="data2d" placeholder="ä¾‹: https://example.com" value="HELLO WORLD æ—¥æœ¬èª">
                    </div>
                </div>

                <!-- GS1-DataMatrixå°‚ç”¨å…¥åŠ›è£œåŠ© -->
                <div id="gs1AssistUI_2D" class="control-char-ui" style="display: none;">
                    <div style="display: flex; justify-content: flex-end; align-items: center;">
                        <select id="gs1PatternSelect_DataMatrix" class="gs1-pattern-select" onchange="applyGS1Pattern2D()" style="width: 100%; max-width: 600px; padding: 8px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 0.9em;">
                            <option value="">GS1-DataMatrix ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¿ãƒ¼ãƒ³å…¥åŠ›è£œåŠ©...</option>
                            <optgroup label="åŸºæœ¬ãƒ‘ã‚¿ãƒ¼ãƒ³">
                                <option value="{FNC1}0100012345678905{FNC1}10ABC123">{FNC1}(01)å•†å“è­˜åˆ¥ + {FNC1}(10)ãƒãƒƒãƒ: (01)00012345678905(10)ABC123</option>
                                <option value="{FNC1}0100012345678905{FNC1}17251231">{FNC1}(01)å•†å“è­˜åˆ¥ + {FNC1}(17)æœ‰åŠ¹æœŸé™: (01)00012345678905(17)251231</option>
                                <option value="{FNC1}0100012345678905{FNC1}21SERIAL123">{FNC1}(01)å•†å“è­˜åˆ¥ + {FNC1}(21)ã‚·ãƒªã‚¢ãƒ«: (01)00012345678905(21)SERIAL123</option>
                                <option value="{FNC1}01000123456789051511250031001234">{FNC1}(01)å•†å“è­˜åˆ¥ + (15)æœŸé™ + (30)æ•°é‡: (01)00012345678905(15)112500(30)001234</option>
                            </optgroup>
                            <optgroup label="è¨ˆé‡å•†å“ï¼ˆé‡é‡ãƒ»ä¾¡æ ¼ï¼‰">
                                <option value="{FNC1}01900123456789083103001750">{FNC1}(01) + (3103)é‡é‡kg(0.001): (01)90012345678908(3103)001750</option>
                                <option value="{FNC1}01900123456789083202000156">{FNC1}(01) + (3202)é‡é‡lb(0.01): (01)90012345678908(3202)000156</option>
                                <option value="{FNC1}01900123456789083203022767">{FNC1}(01) + (3203)é‡é‡lb(0.001): (01)90012345678908(3203)022767</option>
                                <option value="{FNC1}0190012345678908392207950">{FNC1}(01) + (3922)ä¾¡æ ¼: (01)90012345678908(3922)07950</option>
                            </optgroup>
                            <optgroup label="è¨ˆé‡å•†å“+æ—¥ä»˜">
                                <option value="{FNC1}0190012345678908310301223311991231">{FNC1}(01) + (3103)é‡é‡ + (11)è£½é€ å¹´æœˆæ—¥</option>
                                <option value="{FNC1}0190012345678908310301223313991231">{FNC1}(01) + (3103)é‡é‡ + (13)åŒ…è£…å¹´æœˆæ—¥</option>
                                <option value="{FNC1}0190012345678908310301223315991231">{FNC1}(01) + (3103)é‡é‡ + (15)å“è³ªä¿æŒæœŸé™</option>
                                <option value="{FNC1}0190012345678908310301223317991231">{FNC1}(01) + (3103)é‡é‡ + (17)æœ‰åŠ¹æœŸé™</option>
                            </optgroup>
                        </select>
                    </div>
                </div>

                <!-- ä½ç½®ãƒ»ã‚µã‚¤ã‚ºãƒ»è‰²è¨­å®šï¼ˆã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã«ï¼‰ -->
                <div class="form-section">
                    <div class="compact-row">
                        <div class="compact-item">
                            <label for="x2d">Xåº§æ¨™</label>
                            <input type="number" id="x2d" value="20" min="0" max="1000">
                        </div>
                        <div class="compact-item">
                            <label for="y2d">Yåº§æ¨™</label>
                            <input type="number" id="y2d" value="20" min="0" max="1000">
                        </div>
                        <div class="compact-item">
                            <label for="size2d">ã‚µã‚¤ã‚º</label>
                            <input type="number" id="size2d" value="300" min="100" max="1000" class="wide">
                        </div>
                    </div>
                </div>

                <!-- è‰²ãƒ»ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¨­å®šï¼ˆ1è¡Œã«ï¼‰ -->
                <div class="form-section">
                    <div class="compact-row">
                        <div class="compact-item">
                            <label for="foreColor2d">å‰æ™¯è‰²</label>
                            <div class="color-input-group">
                                <input type="color" id="foreColor2d" value="#000000">
                                <input type="text" id="foreColorText2d" value="#000000" readonly>
                            </div>
                        </div>
                        <div class="compact-item">
                            <label for="backColor2d">èƒŒæ™¯è‰²</label>
                            <div class="color-input-group">
                                <input type="color" id="backColor2d" value="#ffffff">
                                <input type="text" id="backColorText2d" value="#ffffff" readonly>
                            </div>
                        </div>
                        <div class="compact-item">
                            <label for="encoding2d">æ–‡å­—</label>
                            <select id="encoding2d" style="padding: 6px 8px; font-size: 0.9em;">
                                <option value="utf-8">UTF-8</option>
                                <option value="shift-jis">Shift-JIS</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å›ºæœ‰ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ -->
            <div id="specificProps2d" class="specific-props">
                <h3>å›ºæœ‰ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£</h3>
                <div id="specificPropsContent2d" class="form-grid"></div>
            </div>

            <!-- ç”Ÿæˆãƒœã‚¿ãƒ³ã¨å‡ºåŠ›ãƒ¢ãƒ¼ãƒ‰é¸æŠ -->
            <div class="generate-row">
                <button class="generate-btn" onclick="generate2D()">2æ¬¡å…ƒãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ</button>
                <div class="output-mode-select">
                    <span class="mode-label">å‡ºåŠ›:</span>
                    <label class="radio-option">
                        <input type="radio" name="outputMode2d" value="browser" checked>
                        <span>ãƒ–ãƒ©ã‚¦ã‚¶</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="outputMode2d" value="pdf">
                        <span>PDF</span>
                    </label>
                </div>
                <div class="rotate-select">
                    <label for="rotateAngle2d">ğŸ”„ å›è»¢:</label>
                    <select id="rotateAngle2d">
                        <option value="0">0Â°</option>
                        <option value="90">90Â°</option>
                        <option value="180">180Â°</option>
                        <option value="270">270Â°</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- ========== ç‰¹æ®Šãƒãƒ¼ã‚³ãƒ¼ãƒ‰ ========== -->
        <div id="special-content" class="main-tab-content">
            <div class="form-grid">
                <!-- è¡Œ1: ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç¨®é¡ -->
                <div class="form-row single">
                    <div class="form-group">
                        <label for="barcodeSpecialType">ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç¨®é¡ *</label>
                        <select id="barcodeSpecialType" onchange="updateSpecialProps()">
                            <option value="ConvenienceStore">æ¨™æº–æ–™é‡‘ä»£ç†åç´ç”¨ã‚³ãƒ³ãƒ“ãƒ‹ãƒãƒ¼ã‚³ãƒ¼ãƒ‰</option>
                            <option value="YubinCustomer">éƒµä¾¿ã‚«ã‚¹ã‚¿ãƒãƒãƒ¼ã‚³ãƒ¼ãƒ‰</option>
                        </select>
                    </div>
                </div>

                <!-- è¡Œ2: ãƒ’ãƒ³ãƒˆ + ãƒ‡ãƒ¼ã‚¿å…¥åŠ› -->
                <div class="form-row full-width">
                    <div class="form-group">
                        <label for="dataSpecial">ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ *</label>
                        <div id="specialBarcodeHint" style="font-size: 0.85em; color: #666; margin-bottom: 5px; padding: 8px 12px; background: #f0f8ff; border-left: 4px solid #4a90e2; border-radius: 4px;">
                            æ¨™æº–æ–™é‡‘ä»£ç†åç´ç”¨ã‚³ãƒ³ãƒ“ãƒ‹ãƒãƒ¼ã‚³ãƒ¼ãƒ‰: GS1-128å½¢å¼ã€‚å…ˆé ­ã«{FNC1}ãŒå¿…è¦ã€‚43æ¡ã®æ•°å­—ï¼ˆæœ«å°¾ãƒã‚§ãƒƒã‚¯ãƒ‡ã‚£ã‚¸ãƒƒãƒˆã¯è‡ªå‹•ä»˜ä¸ã§44æ¡ï¼‰ã€‚å…ˆé ­91ã¯æ–™é‡‘åç´ã‚’ç¤ºã™ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è­˜åˆ¥å­ã€‚
                        </div>
                        <input type="text" id="dataSpecial" placeholder="ä¾‹: {FNC1}9191234500000000000000452087500401310029500" value="{FNC1}9191234500000000000000452087500401310029500">
                    </div>
                </div>

                <!-- GS1å…¥åŠ›è£œåŠ©UIï¼ˆç‰¹æ®Šãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”¨ï¼‰ -->
                <div class="form-row full-width" id="gs1AssistUI_Special">
                    <div class="form-group">
                        <label>ğŸ“‹ ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰é¸æŠ</label>
                        
                        <!-- æ¨™æº–æ–™é‡‘ä»£ç†åç´ç”¨ã‚³ãƒ³ãƒ“ãƒ‹ãƒãƒ¼ã‚³ãƒ¼ãƒ‰å°‚ç”¨ -->
                        <select id="gs1PatternSelect_ConvenienceStore_Special" class="gs1-pattern-select" onchange="applyGS1PatternSpecial()" style="width: 100%; max-width: 600px; padding: 8px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 0.9em;">
                            <option value="">ã‚³ãƒ³ãƒ“ãƒ‹ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰...</option>
                            <optgroup label="æ–™é‡‘åç´ï¼ˆ91: æ¨™æº–æ–™é‡‘ä»£ç†åç´ï¼‰">
                                <option value="{FNC1}9191234500000000000000452087500401310029500">é›»æ°—æ–™é‡‘ä¾‹: 91-91234500000000000000452087500401310029500</option>
                                <option value="{FNC1}9100000000000000000000100000000000000000001">æœ€å°ä¾‹: 91-0...0-100å††-0...0-1</option>
                            </optgroup>
                            <optgroup label="æ‰•è¾¼ç¥¨ï¼ˆ91: EAN-128æ‰•è¾¼ç¥¨ï¼‰">
                                <option value="{FNC1}9112345678901234567890123456789012345678901">æ‰•è¾¼ç¥¨ä¾‹1: 91-123456789012345678901234567890123456789-01</option>
                                <option value="{FNC1}9198765432109876543210987654321098765432100">æ‰•è¾¼ç¥¨ä¾‹2: 91-987654321098765432109876543210987654321-00</option>
                            </optgroup>
                        </select>

                        <!-- éƒµä¾¿ã‚«ã‚¹ã‚¿ãƒãƒãƒ¼ã‚³ãƒ¼ãƒ‰å°‚ç”¨ -->
                        <select id="gs1PatternSelect_YubinCustomer_Special" class="gs1-pattern-select" onchange="applyGS1PatternSpecial()" style="width: 100%; max-width: 600px; padding: 8px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 0.9em; display: none;">
                            <option value="">éƒµä¾¿ã‚«ã‚¹ã‚¿ãƒãƒãƒ¼ã‚³ãƒ¼ãƒ‰ ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰...</option>
                            <optgroup label="éƒµä¾¿ç•ªå·+ä½æ‰€è¡¨ç¤ºç•ªå·">
                                <option value="27500263-29-2-401">ä¾‹1: 275-0026 + 3-29-2-401</option>
                                <option value="1638001-2-10-10-204">ä¾‹2: 163-8001 + 2-10-10-204ï¼ˆæ–°å®¿åŒºå½¹æ‰€ï¼‰</option>
                                <option value="1050011-1-1">ä¾‹3: 105-0011 + 1-1ï¼ˆèŠå…¬åœ’ï¼‰</option>
                                <option value="6000000">ä¾‹4: 600-0000ï¼ˆéƒµä¾¿ç•ªå·ã®ã¿ï¼‰</option>
                            </optgroup>
                            <optgroup label="ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆèª¬æ˜">
                                <option value="" disabled>éƒµä¾¿ç•ªå·7æ¡ + ãƒã‚¤ãƒ•ãƒ³ + ä½æ‰€è¡¨ç¤ºç•ªå·</option>
                                <option value="" disabled>ä½æ‰€è¡¨ç¤ºç•ªå·: ç”ºåŸŸå-ä¸ç›®-ç•ªåœ°-å·-å»ºç‰©ç•ªå·</option>
                            </optgroup>
                        </select>
                    </div>
                </div>

                <!-- è¡Œ3: ä½ç½®ãƒ»ã‚µã‚¤ã‚ºè¨­å®šï¼ˆ1è¡Œã«ï¼‰ -->
                <div class="form-section">
                    <div class="compact-row">
                        <div class="compact-item">
                            <label for="xSpecial">Xåº§æ¨™</label>
                            <input type="number" id="xSpecial" value="20" min="0" max="1000">
                        </div>
                        <div class="compact-item">
                            <label for="ySpecial">Yåº§æ¨™</label>
                            <input type="number" id="ySpecial" value="20" min="0" max="1000">
                        </div>
                        <div class="compact-item" id="grp_widthSpecial">
                            <label for="widthSpecial">å¹…</label>
                            <input type="number" id="widthSpecial" value="500" min="100" max="2000" class="wide">
                        </div>
                        <div class="compact-item">
                            <label for="heightSpecial">é«˜ã•</label>
                            <input type="number" id="heightSpecial" value="30" min="20" max="500">
                        </div>
                        <div class="compact-checkbox" id="grp_fitWidthSpecial">
                            <input type="checkbox" id="fitWidthSpecial" checked>
                            <label for="fitWidthSpecial">å¹…ã´ã£ãŸã‚Šï¼ˆå°æ•°pxï¼‰</label>
                        </div>
                    </div>
                </div>

                <!-- è‰²ãƒ»ãƒ”ã‚¯ã‚»ãƒ«èª¿æ•´è¨­å®šï¼ˆ1è¡Œã«ï¼‰ -->
                <div class="form-section">
                    <div class="compact-row">
                        <div class="compact-item">
                            <label for="foreColorSpecial">å‰æ™¯è‰²</label>
                            <div class="color-input-group">
                                <input type="color" id="foreColorSpecial" value="#000000">
                                <input type="text" id="foreColorTextSpecial" value="#000000" readonly>
                            </div>
                        </div>
                        <div class="compact-item">
                            <label for="backColorSpecial">èƒŒæ™¯è‰²</label>
                            <div class="color-input-group">
                                <input type="color" id="backColorSpecial" value="#ffffff">
                                <input type="text" id="backColorTextSpecial" value="#ffffff" readonly>
                            </div>
                        </div>
                        <div class="compact-item">
                            <label for="pxAdjustBlackSpecial">é»’ãƒãƒ¼èª¿æ•´</label>
                            <input type="number" id="pxAdjustBlackSpecial" value="0" min="-5" max="5">
                        </div>
                        <div class="compact-item">
                            <label for="pxAdjustWhiteSpecial">ç™½ã‚¹ãƒšèª¿æ•´</label>
                            <input type="number" id="pxAdjustWhiteSpecial" value="0" min="-5" max="5">
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç”Ÿæˆãƒœã‚¿ãƒ³ã¨å‡ºåŠ›ãƒ¢ãƒ¼ãƒ‰é¸æŠ -->
            <div class="generate-row">
                <button class="generate-btn" onclick="generateSpecial()">ç‰¹æ®Šãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ</button>
                <div class="output-mode-select">
                    <span class="mode-label">å‡ºåŠ›:</span>
                    <label class="radio-option">
                        <input type="radio" name="outputModeSpecial" value="browser" checked>
                        <span>ãƒ–ãƒ©ã‚¦ã‚¶</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="outputModeSpecial" value="pdf">
                        <span>PDF</span>
                    </label>
                </div>
                <div class="rotate-select">
                    <label for="rotateAngleSpecial">ğŸ”„ å›è»¢:</label>
                    <select id="rotateAngleSpecial">
                        <option value="0">0Â°</option>
                        <option value="90">90Â°</option>
                        <option value="180">180Â°</option>
                        <option value="270">270Â°</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div id="result">
            <p style="color: #999;">ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</p>
        </div>

        <!-- ãƒ­ã‚°è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div id="debugLog" style="margin-top: 30px; padding: 20px; background: #f0f0f0; border-radius: 8px; max-height: 400px; overflow-y: auto; font-family: monospace; font-size: 12px; display: none;">
            <h3 style="margin-bottom: 10px;">ğŸ” ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°</h3>
            <div id="logContent"></div>
        </div>

    </div>

    <script type="module">
        // ============================================================
        // Barcode.WASM ãƒ‡ãƒ¢ãƒ—ãƒ­ã‚°ãƒ©ãƒ 
        // ============================================================
        // ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€Barcode.WASM ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ä½¿ç”¨æ–¹æ³•ã‚’ç¤ºã™
        // ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”¨HTMLã§ã™ã€‚
        // 
        // ã€ä¸»ãªæ©Ÿèƒ½ã€‘
        // - 1æ¬¡å…ƒãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”Ÿæˆï¼ˆCODE39, CODE128, JAN, UPC, GS1-128ãªã©ï¼‰
        // - 2æ¬¡å…ƒãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”Ÿæˆï¼ˆQR, DataMatrix, PDF417ï¼‰
        // - PNGç”»åƒå‡ºåŠ› / SVGãƒ™ã‚¯ã‚¿ãƒ¼å‡ºåŠ›ã®åˆ‡ã‚Šæ›¿ãˆ
        // 
        // ã€å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã€‘
        // - barcode.js   : EmscriptenãŒç”Ÿæˆã—ãŸJavaScriptã‚°ãƒ«ãƒ¼ã‚³ãƒ¼ãƒ‰
        // - barcode.wasm : ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ¸ˆã¿WebAssemblyãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
        // ============================================================

        import Module from './barcode.js';

        // ============================================================
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        // ============================================================
        // barcodeModule: WASMãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
        // Module()ãŒå®Œäº†ã™ã‚‹ã¾ã§ã¯null
        let barcodeModule = null;

        // jsPDFãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å‚ç…§ï¼ˆPDFå‡ºåŠ›ç”¨ï¼‰
        const { jsPDF } = window.jspdf;

        // ============================================================
        // WASMãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆæœŸåŒ–
        // ============================================================
        // EmscriptenãŒç”Ÿæˆã—ãŸModule()é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã€
        // WASMãƒã‚¤ãƒŠãƒªã‚’ãƒ­ãƒ¼ãƒ‰ãƒ»ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¾ã™ã€‚
        // å®Œäº†å¾Œã€barcodeModuleã«å„ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚¯ãƒ©ã‚¹ãŒæ ¼ç´ã•ã‚Œã¾ã™ã€‚
        Module().then(module => {
            barcodeModule = module;
            console.log('âœ… Barcode.WASM ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿å®Œäº†');
            console.log('åˆ©ç”¨å¯èƒ½ãªãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚¯ãƒ©ã‚¹:', Object.keys(module).filter(k => k.match(/^(Code|GS1|NW7|Jan|Upc|Matrix|NEC|Yubin|QR|Data|PDF)/)));
        }).catch(err => {
            console.error('âŒ Barcode.WASM ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿å¤±æ•—:', err);
            document.getElementById('result').innerHTML = 
                '<p class="error">WASMãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</p>';
        });

        // ============================================================
        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
        // ============================================================

        /**
         * è‰²å¤‰æ›´æ™‚ã®ãƒ†ã‚­ã‚¹ãƒˆæ›´æ–°
         * ã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼ã®å€¤ã‚’ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã«åæ˜ 
         */
        ['foreColor1d', 'backColor1d', 'foreColor2d', 'backColor2d', 'foreColorSpecial', 'backColorSpecial'].forEach(id => {
            const input = document.getElementById(id);
            const text = document.getElementById(id.replace('Color', 'ColorText'));
            if (input && text) {
                input.addEventListener('input', () => {
                    text.value = input.value;
                });
            }
        });

        /**
         * ãƒ¡ã‚¤ãƒ³ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
         * 1æ¬¡å…ƒ/2æ¬¡å…ƒãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã®è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆ
         */
        window.switchMainTab = function(tab) {
            document.querySelectorAll('.main-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.main-tab-content').forEach(t => t.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tab + '-content').classList.add('active');
        };

        /**
         * 16é€²æ•°ã‚«ãƒ©ãƒ¼ã‚’RGBã«å¤‰æ›
         * @param {string} hex - "#RRGGBB"å½¢å¼ã®16é€²æ•°ã‚«ãƒ©ãƒ¼
         * @returns {Object} {r, g, b}ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
         */
        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : { r: 0, g: 0, b: 0 };
        }

        // ============================================================
        // ãƒ­ã‚°æ©Ÿèƒ½
        // ============================================================
        
        /**
         * ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã‚’è¿½åŠ 
         * @param {string} message - ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
         * @param {boolean} isError - ã‚¨ãƒ©ãƒ¼ãƒ•ãƒ©ã‚°
         */
        function addLog(message, isError = false) {
            const logDiv = document.getElementById('debugLog');
            const logContent = document.getElementById('logContent');
            logDiv.style.display = 'block';
            
            const logEntry = document.createElement('div');
            logEntry.style.padding = '5px';
            logEntry.style.marginBottom = '3px';
            logEntry.style.borderLeft = isError ? '3px solid #e74c3c' : '3px solid #4caf50';
            logEntry.style.backgroundColor = isError ? '#ffe5e5' : '#e8f5e9';
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logContent.appendChild(logEntry);
            
            // è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            logDiv.scrollTop = logDiv.scrollHeight;
            
            console.log(message);
        }

        /**
         * ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢
         */
        function clearLog() {
            document.getElementById('logContent').innerHTML = '';
        }

        // ============================================================
        // 1æ¬¡å…ƒãƒãƒ¼ã‚³ãƒ¼ãƒ‰å›ºæœ‰ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£æ›´æ–°
        // ============================================================
        window.update1DProps = function() {
            const type = document.getElementById('barcode1dType').value;
            const propsDiv = document.getElementById('specificProps1d');
            const content = document.getElementById('specificPropsContent1d');
            const dataInput = document.getElementById('data1d');
            const hintDiv = document.getElementById('barcodeHint');

            // ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—åˆ¥ã®åˆæœŸå€¤ã¨ãƒ’ãƒ³ãƒˆè¨­å®š
            const barcodeSettings = {
                'Code39': {
                    value: 'HELLO123',
                    hint: 'æ•°å­—ï¼ˆ0-9ï¼‰ã€è‹±å­—å¤§æ–‡å­—ï¼ˆA-Zï¼‰ã€è¨˜å·ï¼ˆ- . ã‚¹ãƒšãƒ¼ã‚¹ $ / + %ï¼‰ãŒä½¿ç”¨å¯èƒ½ã§ã™'
                },
                'Code93': {
                    value: 'HELLO123',
                    hint: 'ASCIIæ–‡å­—å…¨èˆ¬ãŒä½¿ç”¨å¯èƒ½ã§ã™ï¼ˆæ•°å­—ã€è‹±å­—å¤§æ–‡å­—/å°æ–‡å­—ã€è¨˜å·ï¼‰'
                },
                'Code128': {
                    value: 'Hello123',
                    hint: 'ASCIIæ–‡å­—å…¨èˆ¬ãŒä½¿ç”¨å¯èƒ½ã§ã™ã€‚åˆ¶å¾¡æ–‡å­—ã¯ä¸‹ã®ã€Œåˆ¶å¾¡æ–‡å­—ã‚’æŒ¿å…¥ã€ã‹ã‚‰ {CR}, {LF} ç­‰ã®å½¢å¼ã§å…¥åŠ›ã§ãã¾ã™'
                },
                'GS1_128': {
                    value: '{FNC1}0100012345678905{AI}10ABC123',
                    hint: 'GS1-128: å¯å¤‰é•·ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å‰ã«{FNC1}ã‚’å…¥åŠ›(ã‚»ãƒ‘ãƒ¬ãƒ¼ã‚¿ã¨ã—ã¦æ©Ÿèƒ½)ã€‚å›ºå®šé•·AIã§æ‹¬å¼§è¡¨ç¤ºãŒå¿…è¦ãªå ´åˆã¯{AI}XXã‚’ä½¿ç”¨ã€‚ä¾‹: {FNC1}0100012345678905{AI}10ABC123'
                },
                'ConvenienceStore': {
                    value: '{FNC1}9191234500000000000000452087500401310029500',
                    hint: 'æ¨™æº–æ–™é‡‘ä»£ç†åç´ç”¨ã‚³ãƒ³ãƒ“ãƒ‹ãƒãƒ¼ã‚³ãƒ¼ãƒ‰: GS1-128å½¢å¼ã€‚å…ˆé ­ã«{FNC1}ãŒå¿…è¦ã€‚43æ¡ã®æ•°å­—ï¼ˆæœ«å°¾ãƒã‚§ãƒƒã‚¯ãƒ‡ã‚£ã‚¸ãƒƒãƒˆã¯è‡ªå‹•ä»˜ä¸ã§44æ¡ï¼‰ã€‚å…ˆé ­91ã¯æ–™é‡‘åç´ã‚’ç¤ºã™ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è­˜åˆ¥å­ã€‚'
                },
                'NW7': {
                    value: 'A1234567A',
                    hint: 'æ•°å­—ï¼ˆ0-9ï¼‰ã€è¨˜å·ï¼ˆ- $ : / . +ï¼‰ãŒä½¿ç”¨å¯èƒ½ã€‚ã‚¹ã‚¿ãƒ¼ãƒˆ/ã‚¹ãƒˆãƒƒãƒ—ã‚³ãƒ¼ãƒ‰ã¯A/B/C/Dã‹ã‚‰é¸æŠ'
                },
                'Matrix2of5': {
                    value: '1234567890',
                    hint: 'æ•°å­—ã®ã¿ï¼ˆ0-9ï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'
                },
                'NEC2of5': {
                    value: '1234567890',
                    hint: 'æ•°å­—ã®ã¿ï¼ˆ0-9ï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'
                },
                'Jan8': {
                    value: '4901234',
                    hint: '7æ¡ã®æ•°å­—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚8æ¡ç›®ã®ãƒã‚§ãƒƒã‚¯ãƒ‡ã‚£ã‚¸ãƒƒãƒˆã¯è‡ªå‹•è¨ˆç®—ã•ã‚Œã¾ã™ã€‚æ—¥æœ¬ã®å•†å“ã‚³ãƒ¼ãƒ‰ã¯49ã‹ã‚‰å§‹ã¾ã‚Šã¾ã™'
                },
                'Jan13': {
                    value: '491234567890',
                    hint: '12æ¡ã®æ•°å­—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚13æ¡ç›®ã®ãƒã‚§ãƒƒã‚¯ãƒ‡ã‚£ã‚¸ãƒƒãƒˆã¯è‡ªå‹•è¨ˆç®—ã•ã‚Œã¾ã™ã€‚æ—¥æœ¬ã®å•†å“ã‚³ãƒ¼ãƒ‰ã¯49ã¾ãŸã¯45ã‹ã‚‰å§‹ã¾ã‚Šã¾ã™'
                },
                'UPC_A': {
                    value: '01234567890',
                    hint: 'UPC-A: 11æ¡ã¾ãŸã¯12æ¡ã®æ•°å­—ã€‚11æ¡ã®å ´åˆãƒã‚§ãƒƒã‚¯ãƒ‡ã‚£ã‚¸ãƒƒãƒˆè‡ªå‹•ä»˜ä¸ã€‚åŒ—ç±³ã®å•†å“ã‚³ãƒ¼ãƒ‰'
                },
                'UPC_E': {
                    value: '425261',
                    hint: 'UPC-E: 6~7æ¡ã®æ•°å­—ã€‚6æ¡ã®å ´åˆãƒã‚§ãƒƒã‚¯ãƒ‡ã‚£ã‚¸ãƒƒãƒˆè‡ªå‹•ä»˜ä¸ã€‚6/7æ¡ã¯å…ˆé ­0è‡ªå‹•ä»˜ä¸'
                },
                'ITF14': {
                    value: '1491234567890',
                    hint: '13æ¡ã®æ•°å­—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚14æ¡ç›®ã®ãƒã‚§ãƒƒã‚¯ãƒ‡ã‚£ã‚¸ãƒƒãƒˆã¯è‡ªå‹•è¨ˆç®—ã•ã‚Œã¾ã™ã€‚ç‰©æµç”¨ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã§ã™'
                },
                'GS1DataBar14': {
                    value: '1234567890128',
                    hint: 'GS1 DataBar æ¨™æº–å‹: 8-13æ¡ã®æ•°å­—ã€‚13æ¡æœªæº€ã¯å·¦ã‚¼ãƒ­ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã€‚ãƒã‚§ãƒƒã‚¯ãƒ‡ã‚£ã‚¸ãƒƒãƒˆè‡ªå‹•è¨ˆç®—ã§14æ¡(GTIN-14)ã€‚'
                },
                'GS1DataBarLimited': {
                    value: '0123456789012',
                    hint: 'GS1 DataBar é™å®šå‹: 8-13æ¡ã®æ•°å­—ã€‚13æ¡æœªæº€ã¯å·¦ã‚¼ãƒ­ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã€‚ãƒã‚§ãƒƒã‚¯ãƒ‡ã‚£ã‚¸ãƒƒãƒˆè‡ªå‹•è¨ˆç®—ã§14æ¡ã€‚å…ˆé ­æ¡ã¯0ã¾ãŸã¯1ã®ã¿ï¼ˆåˆ¶ç´„ã‚ã‚Šï¼‰ã€‚'
                },
                'GS1DataBarExpanded': {
                    value: '0100012345678905{AI}10ABC123',
                    hint: 'GS1 DataBar æ‹¡å¼µå‹: {AI}XXã§AIæ‹¬å¼§è¡¨ç¤ºã€{FNC1}ã¯è‡ªå‹•æŒ¿å…¥ã€‚æ•°å­—æœ€å¤§74æ¡ã€è‹±æ•°å­—æœ€å¤§41æ–‡å­—'
                },
                'YubinCustomer': {
                    value: '27500263-29-2-401',
                    hint: 'éƒµä¾¿ã‚«ã‚¹ã‚¿ãƒãƒãƒ¼ã‚³ãƒ¼ãƒ‰: éƒµä¾¿ç•ªå·7æ¡ + ä½æ‰€è¡¨ç¤ºç•ªå·ï¼ˆãƒã‚¤ãƒ•ãƒ³åŒºåˆ‡ã‚Šå¯ï¼‰ã€‚ä¾‹: 2750026-3-29-2-401'
                }
            };

            // è¨­å®šã‚’é©ç”¨
            const setting = barcodeSettings[type];
            if (setting) {
                dataInput.value = setting.value;
                if (hintDiv) {
                    hintDiv.innerHTML = setting.hint;
                }
            }

            // å›ºæœ‰ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’å‹•çš„ã«å¤‰æ›´
            const propsTitle = document.getElementById('specificPropsTitle1d');
            if (propsTitle) {
                const typeName = document.querySelector(`#barcode1dType option[value="${type}"]`)?.textContent || type;
                propsTitle.textContent = `${typeName} ã®å›ºæœ‰ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£`;
            }

            // åˆ¶å¾¡æ–‡å­—UIã®è¡¨ç¤ºåˆ¶å¾¡ï¼ˆCODE128ã®ã¿ï¼‰
            const controlCharUI = document.getElementById('controlCharUI');
            if (controlCharUI) {
                controlCharUI.style.display = (type === 'Code128') ? 'block' : 'none';
            }

            // GS1å…¥åŠ›è£œåŠ©UIã®è¡¨ç¤ºåˆ¶å¾¡ï¼ˆGS1ç³»ï¼‹éƒµä¾¿ã‚«ã‚¹ã‚¿ãƒï¼‹ã‚³ãƒ³ãƒ“ãƒ‹ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ï¼‰
            const gs1AssistUI = document.getElementById('gs1AssistUI');
            const gs1Selects = {
                'GS1_128': document.getElementById('gs1PatternSelect_GS1_128'),
                'ConvenienceStore': document.getElementById('gs1PatternSelect_ConvenienceStore'),
                'GS1DataBar14': document.getElementById('gs1PatternSelect_GS1DataBar14'),
                'GS1DataBarLimited': document.getElementById('gs1PatternSelect_GS1DataBarLimited'),
                'GS1DataBarExpanded': document.getElementById('gs1PatternSelect_GS1DataBarExpanded'),
                'YubinCustomer': document.getElementById('gs1PatternSelect_YubinCustomer')
            };
            
            if (gs1AssistUI) {
                const showAssistUI = type === 'GS1_128' || type === 'ConvenienceStore' || 
                                     type === 'GS1DataBar14' || type === 'GS1DataBarLimited' || 
                                     type === 'GS1DataBarExpanded' || type === 'YubinCustomer';
                gs1AssistUI.style.display = showAssistUI ? 'block' : 'none';
                
                // ã™ã¹ã¦ã®GS1ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚»ãƒ¬ã‚¯ãƒˆã‚’éè¡¨ç¤ºã«ã™ã‚‹
                Object.values(gs1Selects).forEach(select => {
                    if (select) select.style.display = 'none';
                });
                
                // é¸æŠã•ã‚ŒãŸãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç¨®é¡ã«å¯¾å¿œã™ã‚‹ã‚»ãƒ¬ã‚¯ãƒˆã®ã¿è¡¨ç¤º
                if (showAssistUI && gs1Selects[type]) {
                    gs1Selects[type].style.display = 'block';
                }
            }

            // DataBar14ã‚¿ã‚¤ãƒ—é¸æŠUIã®è¡¨ç¤ºåˆ¶å¾¡
            const grpTypeDatabar14 = document.getElementById('grp_typeDatabar14');
            if (grpTypeDatabar14) {
                grpTypeDatabar14.style.display = (type === 'GS1DataBar14') ? 'block' : 'none';
            }

            // DataBarExpandedã‚¿ã‚¤ãƒ—é¸æŠUIã®è¡¨ç¤ºåˆ¶å¾¡
            const grpTypeDatabarExpanded = document.getElementById('grp_typeDatabarExpanded');
            if (grpTypeDatabarExpanded) {
                grpTypeDatabarExpanded.style.display = (type === 'GS1DataBarExpanded') ? 'block' : 'none';
            }

            // éƒµä¾¿ã‚«ã‚¹ã‚¿ãƒãƒãƒ¼ã‚³ãƒ¼ãƒ‰é¸æŠæ™‚ã®ç‰¹æ®Šå‡¦ç†
            const isYubinCustomer = (type === 'YubinCustomer');
            const grpWidth = document.getElementById('grp_width1d');
            const grpFitWidth = document.getElementById('grp_fitWidth1d');
            const grpShowText = document.getElementById('grp_showText1d');
            const grpTextSettings = document.getElementById('grp_textSettings1d');
            
            if (grpWidth) grpWidth.style.display = isYubinCustomer ? 'none' : 'block';
            if (grpFitWidth) grpFitWidth.style.display = isYubinCustomer ? 'none' : 'block';
            if (grpShowText) grpShowText.style.display = isYubinCustomer ? 'none' : 'block';
            if (grpTextSettings) grpTextSettings.style.display = isYubinCustomer ? 'none' : 'flex';

            // å¹…ãƒ»é«˜ã•ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤è¨­å®š
            const widthInput = document.getElementById('width1d');
            const heightInput = document.getElementById('height1d');
            
            if (type === 'ConvenienceStore') {
                // ã‚³ãƒ³ãƒ“ãƒ‹ãƒãƒ¼ã‚³ãƒ¼ãƒ‰: å¹…500
                if (widthInput) widthInput.value = '500';
                if (heightInput) heightInput.value = '150';
            } else if (type === 'YubinCustomer') {
                // éƒµä¾¿ã‚«ã‚¹ã‚¿ãƒ: é«˜ã•25ï¼ˆå¹…ã¯éè¡¨ç¤ºï¼‰
                if (heightInput) heightInput.value = '25';
            } else {
                // ãã®ä»–: å¹…400, é«˜ã•150ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã«æˆ»ã™ï¼‰
                if (widthInput) widthInput.value = '400';
                if (heightInput) heightInput.value = '150';
            }

            content.innerHTML = '';
            propsDiv.style.display = 'none';

            // Code39å›ºæœ‰ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
            if (type === 'Code39') {
                propsDiv.style.display = 'block';
                content.innerHTML = `
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="showStartStop1d" checked>
                            <label for="showStartStop1d" style="margin: 0;">ã‚¹ã‚¿ãƒ¼ãƒˆ/ã‚¹ãƒˆãƒƒãƒ—ã‚³ãƒ¼ãƒ‰è¡¨ç¤º</label>
                        </div>
                    </div>
                `;
            }

            // NW7å›ºæœ‰ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
            if (type === 'NW7') {
                propsDiv.style.display = 'block';
                content.innerHTML = `
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="showStartStop1d" checked>
                            <label for="showStartStop1d" style="margin: 0;">ã‚¹ã‚¿ãƒ¼ãƒˆ/ã‚¹ãƒˆãƒƒãƒ—ã‚³ãƒ¼ãƒ‰è¡¨ç¤º</label>
                        </div>
                    </div>
                `;
            }

            // Code128å›ºæœ‰ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
            if (type === 'Code128') {
                propsDiv.style.display = 'block';
                content.innerHTML = `
                    <div class="form-group">
                        <label for="codeMode1d">ã‚³ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ‰</label>
                        <select id="codeMode1d">
                            <option value="AUTO" selected>è‡ªå‹•ï¼ˆæœ€çŸ­ï¼‰</option>
                            <option value="A">CODE-A</option>
                            <option value="B">CODE-B</option>
                            <option value="C">CODE-Cï¼ˆæ•°å­—ã®ã¿ï¼‰</option>
                        </select>
                    </div>
                `;
            }

            // JAN/UPCå›ºæœ‰ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
            if (type === 'Jan8' || type === 'Jan13' 
            || type === 'UPC_A' || type === 'UPC_E') {
                propsDiv.style.display = 'block';
                content.innerHTML = `
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="extendedGuard1d" checked>
                            <label for="extendedGuard1d" style="margin: 0;">ã‚¬ãƒ¼ãƒ‰ãƒãƒ¼æ‹¡å¼µï¼ˆæ¨™æº–JAN/UPCè¡¨ç¤ºï¼‰</label>
                        </div>
                    </div>
                `;
            }

            // ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã«ã‚ˆã£ã¦ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’èª¿æ•´
            const textFontScaleInput = document.getElementById('textFontScale1d');
            if (textFontScaleInput) {
                if (type === 'GS1_128' || type === 'ConvenienceStore') {
                    // GS1-128ç³»ã¯AIæ‹¬å¼§è¡¨ç¤ºã®ãŸã‚ã€ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’å°ã•ã‚ã«è¨­å®š
                    textFontScaleInput.value = '0.7';
                } else if (type === 'GS1DataBarExpanded') {
                    // GS1 DataBar æ‹¡å¼µå‹ã¯å¤šå±¤ã®å ´åˆ0.7ã€ä¸€å±¤ã®å ´åˆ1.0
                    const expandedType = document.getElementById('typeDatabarExpanded');
                    if (expandedType && expandedType.value === 'STACKED') {
                        textFontScaleInput.value = '0.7';
                    } else {
                        textFontScaleInput.value = '1.0';
                    }
                } else {
                    // ãã®ä»–ã®ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã¯æ¨™æº–ã‚µã‚¤ã‚º
                    textFontScaleInput.value = '1.0';
                }
            }

        };

        /**
         * GS1 DataBar Expanded ã‚¿ã‚¤ãƒ—å¤‰æ›´æ™‚ã®ãƒ•ã‚©ãƒ³ãƒˆã‚¹ã‚±ãƒ¼ãƒ«æ›´æ–°
         */
        window.updateDataBarExpandedFontScale = function() {
            const type = document.getElementById('barcode1dType').value;
            if (type !== 'GS1DataBarExpanded') return;
            
            const expandedType = document.getElementById('typeDatabarExpanded');
            const textFontScaleInput = document.getElementById('textFontScale1d');
            
            if (expandedType && textFontScaleInput) {
                if (expandedType.value === 'STACKED') {
                    textFontScaleInput.value = '0.7';
                } else {
                    textFontScaleInput.value = '1.0';
                }
            }
        };

        /**
         * GS1ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¿ãƒ¼ãƒ³é©ç”¨ï¼ˆ1æ¬¡å…ƒãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”¨ï¼‰
         */
        window.applyGS1Pattern = function() {
            const selects = [
                { id: 'gs1PatternSelect_GS1_128', inputId: 'data1d' },
                { id: 'gs1PatternSelect_ConvenienceStore', inputId: 'data1d' },
                { id: 'gs1PatternSelect_GS1DataBar14', inputId: 'data1d' },
                { id: 'gs1PatternSelect_GS1DataBarLimited', inputId: 'data1d' },
                { id: 'gs1PatternSelect_GS1DataBarExpanded', inputId: 'data1d' },
                { id: 'gs1PatternSelect_YubinCustomer', inputId: 'data1d' }
            ];
            
            for (const item of selects) {
                const select = document.getElementById(item.id);
                if (select && select.style.display !== 'none' && select.value && select.value !== '') {
                    const dataInput = document.getElementById(item.inputId);
                    if (dataInput) {
                        dataInput.value = select.value;
                        select.selectedIndex = 0;
                        break;
                    }
                }
            }
        };

        // ============================================================
        // 2æ¬¡å…ƒãƒãƒ¼ã‚³ãƒ¼ãƒ‰å›ºæœ‰ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£æ›´æ–°
        // ============================================================
        window.update2DProps = function() {
            const type = document.getElementById('barcode2dType').value;
            const content = document.getElementById('specificPropsContent2d');
            const propsDiv = document.getElementById('specificProps2d');

            // GS1-DataMatrixå°‚ç”¨å…¥åŠ›è£œåŠ©UIã®è¡¨ç¤ºåˆ¶å¾¡
            const gs1AssistUI_2D = document.getElementById('gs1AssistUI_2D');
            if (gs1AssistUI_2D) {
                gs1AssistUI_2D.style.display = (type === 'DataMatrix') ? 'block' : 'none';
            }

            content.innerHTML = '';

            // QRå›ºæœ‰ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
            if (type === 'QR') {
                propsDiv.style.display = 'block';
                content.innerHTML = `
                    <div class="form-row triple">
                        <div class="form-group">
                            <label for="errorLevel2d">èª¤ã‚Šè¨‚æ­£ãƒ¬ãƒ™ãƒ«</label>
                            <select id="errorLevel2d">
                                <option value="L">Lï¼ˆç´„7%ï¼‰</option>
                                <option value="M" selected>Mï¼ˆç´„15%ï¼‰</option>
                                <option value="Q">Qï¼ˆç´„25%ï¼‰</option>
                                <option value="H">Hï¼ˆç´„30%ï¼‰</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="version2d">ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆ0=è‡ªå‹•ï¼‰</label>
                            <input type="number" id="version2d" value="0" min="0" max="40">
                        </div>
                        <div class="form-group">
                            <label for="encodeMode2d">ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ‰</label>
                            <select id="encodeMode2d">
                                <option value="NUMERIC">æ•°å­—ï¼ˆNumericï¼‰</option>
                                <option value="ALPHANUMERIC">è‹±æ•°å­—ï¼ˆAlphaNumericï¼‰</option>
                                <option value="BYTE" selected>ãƒã‚¤ãƒŠãƒªï¼ˆBinaryï¼‰</option>
                                <option value="KANJI">æ¼¢å­—ï¼ˆKanjiï¼‰</option>
                            </select>
                        </div>
                    </div>
                `;
            }

            // DataMatrixå›ºæœ‰ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
            if (type === 'DataMatrix') {
                propsDiv.style.display = 'block';
                content.innerHTML = `
                    <div style="padding: 12px; background: #e8f4f8; border-left: 4px solid #2196F3; border-radius: 4px; margin-bottom: 15px; font-size: 0.9em;">
                        <strong>GS1 DataMatrixã«ã¤ã„ã¦:</strong><br>
                        ãƒ‡ãƒ¼ã‚¿ãŒ<code>{FNC1}</code>ã§å§‹ã¾ã‚‹å ´åˆã€GS1ãƒ¢ãƒ¼ãƒ‰ã¨ã—ã¦å‡¦ç†ã•ã‚Œã¾ã™ã€‚<br>
                        <code>{FNC1}</code>: GS1ãƒ¢ãƒ¼ãƒ‰æŒ‡å®š + å¯å¤‰é•·ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚»ãƒ‘ãƒ¬ãƒ¼ã‚¿ã¨ã—ã¦æ©Ÿèƒ½<br>
                        ä¾‹: <code>{FNC1}0100012345678905{FNC1}17251231</code>
                    </div>
                    <div class="form-row double">
                        <div class="form-group">
                            <label for="codeSize2d">ã‚³ãƒ¼ãƒ‰ã‚µã‚¤ã‚º</label>
                            <select id="codeSize2d">
                                <option value="AUTO" selected>è‡ªå‹•</option>
                                <option value="10x10">10x10</option>
                                <option value="12x12">12x12</option>
                                <option value="14x14">14x14</option>
                                <option value="16x16">16x16</option>
                                <option value="18x18">18x18</option>
                                <option value="20x20">20x20</option>
                                <option value="22x22">22x22</option>
                                <option value="24x24">24x24</option>
                                <option value="26x26">26x26</option>
                                <option value="32x32">32x32</option>
                                <option value="36x36">36x36</option>
                                <option value="40x40">40x40</option>
                                <option value="44x44">44x44</option>
                                <option value="48x48">48x48</option>
                                <option value="52x52">52x52</option>
                                <option value="64x64">64x64</option>
                                <option value="72x72">72x72</option>
                                <option value="80x80">80x80</option>
                                <option value="88x88">88x88</option>
                                <option value="96x96">96x96</option>
                                <option value="104x104">104x104</option>
                                <option value="120x120">120x120</option>
                                <option value="132x132">132x132</option>
                                <option value="144x144">144x144</option>
                                <option value="8x18">8x18ï¼ˆçŸ©å½¢ï¼‰</option>
                                <option value="8x32">8x32ï¼ˆçŸ©å½¢ï¼‰</option>
                                <option value="12x26">12x26ï¼ˆçŸ©å½¢ï¼‰</option>
                                <option value="12x36">12x36ï¼ˆçŸ©å½¢ï¼‰</option>
                                <option value="16x36">16x36ï¼ˆçŸ©å½¢ï¼‰</option>
                                <option value="16x48">16x48ï¼ˆçŸ©å½¢ï¼‰</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="encodeScheme2d">ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚¹ã‚­ãƒ¼ãƒ </label>
                            <select id="encodeScheme2d">
                                <option value="AUTO" selected>è‡ªå‹•ï¼ˆæœ€é©ï¼‰</option>
                                <option value="ASCII">ASCII</option>
                                <option value="C40">C40</option>
                                <option value="TEXT">Text</option>
                                <option value="X12">X12</option>
                                <option value="EDIFACT">Edifact</option>
                                <option value="BASE256">Base256</option>
                            </select>
                        </div>
                    </div>
                `;
            }

            // PDF417å›ºæœ‰ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
            if (type === 'PDF417') {
                propsDiv.style.display = 'block';
                content.innerHTML = `
                    <div class="form-row triple">
                        <div class="form-group">
                            <label for="errorLevel2d">èª¤ã‚Šè¨‚æ­£ãƒ¬ãƒ™ãƒ«</label>
                            <select id="errorLevel2d">
                                <option value="-1" selected>è‡ªå‹•</option>
                                <option value="0">Level 0</option>
                                <option value="1">Level 1</option>
                                <option value="2">Level 2</option>
                                <option value="3">Level 3</option>
                                <option value="4">Level 4</option>
                                <option value="5">Level 5</option>
                                <option value="6">Level 6</option>
                                <option value="7">Level 7</option>
                                <option value="8">Level 8</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="columns2d">åˆ—æ•°ï¼ˆ0=è‡ªå‹•ï¼‰</label>
                            <input type="number" id="columns2d" value="0" min="0" max="30">
                        </div>
                        <div class="form-group">
                            <label for="rows2d">è¡Œæ•°ï¼ˆ0=è‡ªå‹•ï¼‰</label>
                            <input type="number" id="rows2d" value="0" min="0" max="90">
                        </div>
                    </div>
                    <div class="form-row double">
                        <div class="form-group">
                            <label for="aspectRatio2d">ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”</label>
                            <input type="number" id="aspectRatio2d" value="0.5" min="0.1" max="5.0" step="0.1">
                        </div>
                        <div class="form-group">
                            <label for="yHeight2d">Yã®é«˜ã•</label>
                            <input type="number" id="yHeight2d" value="3" min="1" max="10">
                        </div>
                    </div>
                `;
            }
        };

        /**
         * ç‰¹æ®Šãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
         * Gitãƒªãƒãƒ¼ã‚¹ç‰ˆã®update1DPropsã®ConvenienceStore/YubinCustomerå‡¦ç†ã‚’ãƒ™ãƒ¼ã‚¹ã«
         */
        window.updateSpecialProps = function() {
            const type = document.getElementById('barcodeSpecialType').value;
            const hintDiv = document.getElementById('specialBarcodeHint');
            const dataInput = document.getElementById('dataSpecial');
            const widthInput = document.getElementById('widthSpecial');
            const heightInput = document.getElementById('heightSpecial');
            
            // ãƒ‘ã‚¿ãƒ¼ãƒ³é¸æŠUIã®åˆ‡ã‚Šæ›¿ãˆ
            const selectConvenience = document.getElementById('gs1PatternSelect_ConvenienceStore_Special');
            const selectYubin = document.getElementById('gs1PatternSelect_YubinCustomer_Special');
            
            // éƒµä¾¿ã‚«ã‚¹ã‚¿ãƒãƒãƒ¼ã‚³ãƒ¼ãƒ‰é¸æŠæ™‚ã®ç‰¹æ®Šå‡¦ç†
            const isYubinCustomer = (type === 'YubinCustomer');
            const grpWidth = document.getElementById('grp_widthSpecial');
            const grpFitWidth = document.getElementById('grp_fitWidthSpecial');
            
            // éƒµä¾¿ã‚«ã‚¹ã‚¿ãƒ: å¹…ãƒ»å¹…ã´ã£ãŸã‚Šã‚’éè¡¨ç¤º
            if (grpWidth) grpWidth.style.display = isYubinCustomer ? 'none' : 'flex';
            if (grpFitWidth) grpFitWidth.style.display = isYubinCustomer ? 'none' : 'flex';
            
            // ãƒ‘ã‚¿ãƒ¼ãƒ³é¸æŠã®åˆ‡ã‚Šæ›¿ãˆ
            if (selectConvenience) selectConvenience.style.display = isYubinCustomer ? 'none' : 'block';
            if (selectYubin) selectYubin.style.display = isYubinCustomer ? 'block' : 'none';
            
            // å¹…ãƒ»é«˜ã•ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤è¨­å®šã¨ãƒ’ãƒ³ãƒˆæ›´æ–°
            if (type === 'ConvenienceStore') {
                // ã‚³ãƒ³ãƒ“ãƒ‹ãƒãƒ¼ã‚³ãƒ¼ãƒ‰: å¹…500
                if (widthInput) widthInput.value = '500';
                if (heightInput) heightInput.value = '150';
                if (hintDiv) hintDiv.innerHTML = 'æ¨™æº–æ–™é‡‘ä»£ç†åç´ç”¨ã‚³ãƒ³ãƒ“ãƒ‹ãƒãƒ¼ã‚³ãƒ¼ãƒ‰: GS1-128å½¢å¼ã€‚å…ˆé ­ã«{FNC1}ãŒå¿…è¦ã€‚43æ¡ã®æ•°å­—ï¼ˆæœ«å°¾ãƒã‚§ãƒƒã‚¯ãƒ‡ã‚£ã‚¸ãƒƒãƒˆã¯è‡ªå‹•ä»˜ä¸ã§44æ¡ï¼‰ã€‚å…ˆé ­91ã¯æ–™é‡‘åç´ã‚’ç¤ºã™ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è­˜åˆ¥å­ã€‚';
                if (dataInput) {
                    dataInput.value = '{FNC1}9191234500000000000000452087500401310029500';
                    dataInput.placeholder = 'ä¾‹: {FNC1}9191234500000000000000452087500401310029500';
                }
            } else if (type === 'YubinCustomer') {
                // éƒµä¾¿ã‚«ã‚¹ã‚¿ãƒ: é«˜ã•25ï¼ˆå¹…ã¯éè¡¨ç¤ºï¼‰
                if (heightInput) heightInput.value = '25';
                if (hintDiv) hintDiv.innerHTML = 'éƒµä¾¿ã‚«ã‚¹ã‚¿ãƒãƒãƒ¼ã‚³ãƒ¼ãƒ‰: éƒµä¾¿ç•ªå·7æ¡ + ä½æ‰€è¡¨ç¤ºç•ªå·ï¼ˆãƒã‚¤ãƒ•ãƒ³åŒºåˆ‡ã‚Šå¯ï¼‰ã€‚ä¾‹: 2750026-3-29-2-401';
                if (dataInput) {
                    dataInput.value = '27500263-29-2-401';
                    dataInput.placeholder = 'ä¾‹: 27500263-29-2-401';
                }
            }
        };

        /**
         * ç‰¹æ®Šãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”¨GS1ãƒ‘ã‚¿ãƒ¼ãƒ³é©ç”¨
         */
        window.applyGS1PatternSpecial = function() {
            const type = document.getElementById('barcodeSpecialType').value;
            const dataInput = document.getElementById('dataSpecial');
            
            let select;
            if (type === 'ConvenienceStore') {
                select = document.getElementById('gs1PatternSelect_ConvenienceStore_Special');
            } else if (type === 'YubinCustomer') {
                select = document.getElementById('gs1PatternSelect_YubinCustomer_Special');
            }
            
            if (select && select.value) {
                dataInput.value = select.value;
                
                // è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
                const originalBorder = dataInput.style.borderColor;
                dataInput.style.borderColor = '#667eea';
                dataInput.style.boxShadow = '0 0 0 3px rgba(102, 126, 234, 0.1)';
                setTimeout(() => {
                    dataInput.style.borderColor = originalBorder;
                    dataInput.style.boxShadow = '';
                }, 500);
            }
        };

        // åˆæœŸåŒ–
        update1DProps();
        update2DProps();
        updateSpecialProps();

        /**
         * åˆ¶å¾¡æ–‡å­—ã‚’æŒ¿å…¥ã™ã‚‹é–¢æ•°ï¼ˆCODE128ç”¨ï¼‰
         */
        window.insertControlChar = function() {
            const select = document.getElementById('controlCharSelect');
            const dataInput = document.getElementById('data1d');
            
            if (!select.value) {
                return;
            }
            
            const start = dataInput.selectionStart;
            const end = dataInput.selectionEnd;
            const text = dataInput.value;
            
            dataInput.value = text.substring(0, start) + select.value + text.substring(end);
            
            const newPos = start + select.value.length;
            dataInput.setSelectionRange(newPos, newPos);
            dataInput.focus();
            
            select.value = '';
            
            // è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
            const originalBorder = dataInput.style.borderColor;
            dataInput.style.borderColor = '#667eea';
            dataInput.style.boxShadow = '0 0 0 3px rgba(102, 126, 234, 0.1)';
            setTimeout(() => {
                dataInput.style.borderColor = originalBorder;
                dataInput.style.boxShadow = '';
            }, 500);
        };

        // ============================================================
        // 1æ¬¡å…ƒãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
        // ============================================================
        /**
         * 1æ¬¡å…ƒãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¦resultã‚¨ãƒªã‚¢ã«è¡¨ç¤º
         * 
         * ã€Barcode.WASM ä½¿ç”¨æ‰‹é †ã€‘
         * 1. new barcodeModule.XXX() ã§ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
         * 2. setOutputFormat("png" or "svg") ã§å‡ºåŠ›å½¢å¼ã‚’è¨­å®š
         * 3. setForegroundColor() / setBackgroundColor() ã§è‰²è¨­å®š
         * 4. setShowText() / setFitWidth() ç­‰ã§å„ç¨®ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¨­å®š
         * 5. draw(data, width, height) ã§ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
         * 6. PNG: Base64æ–‡å­—åˆ—ãŒè¿”ã‚‹ / SVG: SVGæ–‡å­—åˆ—ãŒè¿”ã‚‹
         * 7. barcode.delete() ã§ãƒ¡ãƒ¢ãƒªè§£æ”¾ï¼ˆé‡è¦ï¼ï¼‰
         */
        window.generate1D = async function() {
            clearLog();
            addLog('=== 1æ¬¡å…ƒãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”Ÿæˆé–‹å§‹ ===');
            
            const type = document.getElementById('barcode1dType').value;
            
            // â˜…Barcode.WASMâ˜… WASMãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®èª­ã¿è¾¼ã¿ç¢ºèª
            if (!barcodeModule) {
                addLog('âŒ WASMãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“', true);
                document.getElementById('result').innerHTML = 
                    '<p class="error">WASMãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒã¾ã èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“</p>';
                return;
            }
            addLog('âœ… WASMãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç¢ºèªOK');

            const data = document.getElementById('data1d').value;
            const width = parseInt(document.getElementById('width1d').value);
            const height = parseInt(document.getElementById('height1d').value);

            // â˜…åº§æ¨™ãƒ»å›è»¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å–å¾—â˜…
            const xPos = parseInt(document.getElementById('x1d').value) || 0;
            const yPos = parseInt(document.getElementById('y1d').value) || 0;
            const rotateAngle = parseInt(document.getElementById('rotateAngle1d').value) || 0;
            addLog(`Xåº§æ¨™: ${xPos}, Yåº§æ¨™: ${yPos}`);
            addLog(`å›è»¢è§’åº¦: ${rotateAngle}Â°`);

            // â˜…å‡ºåŠ›å½¢å¼ã®å–å¾—â˜…ï¼ˆã‚¿ãƒ–ä¸Šéƒ¨ã®å…±é€šãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã‹ã‚‰ï¼‰
            const outputFormat = document.querySelector('input[name="outputFormat"]:checked').value;
            addLog(`å‡ºåŠ›å½¢å¼: ${outputFormat.toUpperCase()}`);

            addLog(`ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç¨®é¡: ${type}`);
            addLog(`ãƒ‡ãƒ¼ã‚¿: ${data}`);
            addLog(`ã‚µã‚¤ã‚º: ${width}x${height}px`);

            if (!data) {
                addLog('âŒ ãƒ‡ãƒ¼ã‚¿ãŒç©ºã§ã™', true);
                alert('ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            document.getElementById('result').innerHTML = '<p class="loading">ç”Ÿæˆä¸­...</p>';

            try {
                addLog('Step 1: ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆä¸­...');
                
                // ç‰¹æ®Šãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã®åˆ¤å®š
                const isConvenienceStore = (type === 'ConvenienceStore');
                const isYubinCustomer = (type === 'YubinCustomer');
                const isGS1DataBar14 = (type === 'GS1DataBar14');
                const isGS1DataBarLimited = (type === 'GS1DataBarLimited');
                const isGS1DataBarExpanded = (type === 'GS1DataBarExpanded');
                
                // â˜…Barcode.WASMâ˜… ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
                // ConvenienceStoreã¯GS1_128ã‚¯ãƒ©ã‚¹ã‚’ä½¿ç”¨
                const wasmType = isConvenienceStore ? 'GS1_128' : type;
                addLog(`new barcodeModule.${wasmType}() å®Ÿè¡Œ`);
                const barcode = new barcodeModule[wasmType]();
                addLog('âœ… ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆæˆåŠŸ');

                // â˜…Barcode.WASMâ˜… å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆè¨­å®šï¼ˆPNG/SVGåˆ‡ã‚Šæ›¿ãˆï¼‰
                // setOutputFormat("png") â†’ draw()ãŒBase64 PNGæ–‡å­—åˆ—ã‚’è¿”ã™
                // setOutputFormat("svg") â†’ draw()ãŒSVGæ–‡å­—åˆ—ã‚’è¿”ã™
                addLog('Step 2: å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆè¨­å®šä¸­...');
                barcode.setOutputFormat(outputFormat);
                addLog(`âœ… å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆè¨­å®šå®Œäº†: ${outputFormat}`);

                // â˜…Barcode.WASMâ˜… å…±é€šãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¨­å®š
                addLog('Step 3: å…±é€šãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¨­å®šä¸­...');
                
                // å‰æ™¯è‰²ãƒ»èƒŒæ™¯è‰²ï¼ˆRGBAã§æŒ‡å®šã€Aã¯é€šå¸¸255ï¼‰
                const foreColor = hexToRgb(document.getElementById('foreColor1d').value);
                const backColor = hexToRgb(document.getElementById('backColor1d').value);
                addLog(`å‰æ™¯è‰²: RGB(${foreColor.r}, ${foreColor.g}, ${foreColor.b})`);
                addLog(`èƒŒæ™¯è‰²: RGB(${backColor.r}, ${backColor.g}, ${backColor.b})`);
                
                barcode.setForegroundColor(foreColor.r, foreColor.g, foreColor.b, 255);
                addLog('âœ… å‰æ™¯è‰²è¨­å®šå®Œäº†');
                
                barcode.setBackgroundColor(backColor.r, backColor.g, backColor.b, 255);
                addLog('âœ… èƒŒæ™¯è‰²è¨­å®šå®Œäº†');
                
                // ãƒ”ã‚¯ã‚»ãƒ«èª¿æ•´ï¼ˆãƒãƒ¼å¹…ã®å¾®èª¿æ•´ç”¨ï¼‰
                const pxAdjustBlack = parseInt(document.getElementById('pxAdjustBlack1d').value);
                const pxAdjustWhite = parseInt(document.getElementById('pxAdjustWhite1d').value);
                addLog(`é»’ãƒãƒ¼èª¿æ•´: ${pxAdjustBlack}px`);
                addLog(`ç™½ã‚¹ãƒšãƒ¼ã‚¹èª¿æ•´: ${pxAdjustWhite}px`);
                barcode.setPxAdjustBlack(pxAdjustBlack);
                barcode.setPxAdjustWhite(pxAdjustWhite);
                addLog('âœ… ãƒ”ã‚¯ã‚»ãƒ«èª¿æ•´è¨­å®šå®Œäº†');
                
                // éƒµä¾¿ã‚«ã‚¹ã‚¿ãƒä»¥å¤–ã¯ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºè¨­å®šã‚’ã‚µãƒãƒ¼ãƒˆ
                if (!isYubinCustomer) {
                    // å¹…ã´ã£ãŸã‚Šæç”»ï¼ˆå°æ•°ç‚¹ãƒ”ã‚¯ã‚»ãƒ«ã‚’ä½¿ç”¨ã—ã¦æ­£ç¢ºãªå¹…ã«ï¼‰
                    const fitWidth = document.getElementById('fitWidth1d').checked;
                    addLog(`å¹…ã´ã£ãŸã‚Šæç”»: ${fitWidth ? 'ON' : 'OFF'}`);
                    barcode.setFitWidth(fitWidth);
                    addLog('âœ… å¹…è¨­å®šå®Œäº†');
                    
                    // ãƒ†ã‚­ã‚¹ãƒˆï¼ˆãƒ‡ãƒ¼ã‚¿æ–‡å­—åˆ—ï¼‰è¡¨ç¤º
                    const showText = document.getElementById('showText1d').checked;
                    addLog(`ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º: ${showText ? 'ON' : 'OFF'}`);
                    barcode.setShowText(showText);
                    addLog('âœ… ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºè¨­å®šå®Œäº†');
                    
                    // ãƒ†ã‚­ã‚¹ãƒˆã‚µã‚¤ã‚ºå€ç‡
                    const textFontScale = parseFloat(document.getElementById('textFontScale1d').value);
                    addLog(`ãƒ†ã‚­ã‚¹ãƒˆã‚µã‚¤ã‚ºå€ç‡: ${textFontScale}`);
                    barcode.setTextFontScale(textFontScale);
                    addLog('âœ… ãƒ†ã‚­ã‚¹ãƒˆã‚µã‚¤ã‚ºè¨­å®šå®Œäº†');
                    
                    // ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã¨ãƒ†ã‚­ã‚¹ãƒˆã®éš™é–“èª¿æ•´
                    const textGap = parseFloat(document.getElementById('textGap1d').value);
                    addLog(`ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã¨ãƒ†ã‚­ã‚¹ãƒˆã®éš™é–“: ${textGap}`);
                    barcode.setTextGap(textGap);
                    addLog('âœ… ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã¨ãƒ†ã‚­ã‚¹ãƒˆã®éš™é–“è¨­å®šå®Œäº†');
                } else {
                    addLog('â„¹ï¸ éƒµä¾¿ã‚«ã‚¹ã‚¿ãƒãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã¯ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºè¨­å®šã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“');
                }

                // â˜…Barcode.WASMâ˜… å›ºæœ‰ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¨­å®š
                addLog('Step 4: å›ºæœ‰ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¨­å®šä¸­...');
                
                // Code39/NW7: ã‚¹ã‚¿ãƒ¼ãƒˆãƒ»ã‚¹ãƒˆãƒƒãƒ—ã‚³ãƒ¼ãƒ‰è¡¨ç¤º
                if (type === 'Code39' || type === 'NW7') {
                    const showStartStop = document.getElementById('showStartStop1d');
                    if (showStartStop) {
                        addLog(`ã‚¹ã‚¿ãƒ¼ãƒˆ/ã‚¹ãƒˆãƒƒãƒ—ã‚³ãƒ¼ãƒ‰è¡¨ç¤º: ${showStartStop.checked ? 'ON' : 'OFF'}`);
                        barcode.setShowStartStop(showStartStop.checked);
                        addLog('âœ… ã‚¹ã‚¿ãƒ¼ãƒˆ/ã‚¹ãƒˆãƒƒãƒ—ã‚³ãƒ¼ãƒ‰è¨­å®šå®Œäº†');
                    }
                }

                // Code128: ã‚³ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ‰ï¼ˆAUTO/A/B/Cï¼‰
                if (type === 'Code128') {
                    const codeMode = document.getElementById('codeMode1d');
                    if (codeMode) {
                        addLog(`ã‚³ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ‰: ${codeMode.value}`);
                        barcode.setCodeMode(codeMode.value);
                        addLog('âœ… ã‚³ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ‰è¨­å®šå®Œäº†');
                    }
                }

                // JAN/UPC: ã‚¬ãƒ¼ãƒ‰ãƒãƒ¼æ‹¡å¼µ
                if (type === 'Jan8' || type === 'Jan13' 
                || type === 'UPC_A' || type === 'UPC_E') {
                    const extendedGuard = document.getElementById('extendedGuard1d');
                    if (extendedGuard) {
                        addLog(`ã‚¬ãƒ¼ãƒ‰ãƒãƒ¼æ‹¡å¼µ: ${extendedGuard.checked ? 'ON' : 'OFF'}`);
                        barcode.setExtendedGuard(extendedGuard.checked);
                        addLog('âœ… ã‚¬ãƒ¼ãƒ‰ãƒãƒ¼è¨­å®šå®Œäº†');
                    }
                }

                // GS1 DataBar 14: ã‚·ãƒ³ãƒœãƒ«ã‚¿ã‚¤ãƒ—
                if (isGS1DataBar14) {
                    const symbolType = document.getElementById('typeDatabar14').value;
                    addLog(`DataBar14 ã‚·ãƒ³ãƒœãƒ«ã‚¿ã‚¤ãƒ—: ${symbolType}`);
                    barcode.setSymbolType(symbolType);
                    addLog('âœ… ã‚·ãƒ³ãƒœãƒ«ã‚¿ã‚¤ãƒ—è¨­å®šå®Œäº†');
                }

                // GS1 DataBar Expanded: ã‚·ãƒ³ãƒœãƒ«ã‚¿ã‚¤ãƒ—ã¨åˆ—æ•°
                if (isGS1DataBarExpanded) {
                    const symbolType = document.getElementById('typeDatabarExpanded').value;
                    addLog(`DataBarExpanded ã‚·ãƒ³ãƒœãƒ«ã‚¿ã‚¤ãƒ—: ${symbolType}`);
                    barcode.setSymbolType(symbolType);
                    addLog('âœ… ã‚·ãƒ³ãƒœãƒ«ã‚¿ã‚¤ãƒ—è¨­å®šå®Œäº†');
                    
                    if (symbolType === 'STACKED') {
                        addLog('Stacked ãƒ¢ãƒ¼ãƒ‰: åˆ—æ•°ã‚’2ã«è¨­å®š');
                        barcode.setNoOfColumns(2);
                        addLog('âœ… åˆ—æ•°è¨­å®šå®Œäº†');
                    }
                }

                // â˜…Barcode.WASMâ˜… ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
                addLog('Step 5: ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”Ÿæˆä¸­...');
                
                let result;
                try {
                    // ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç¨®é¡åˆ¥ã®drawå‘¼ã³å‡ºã—
                    if (isConvenienceStore) {
                        // ã‚³ãƒ³ãƒ“ãƒ‹ãƒãƒ¼ã‚³ãƒ¼ãƒ‰: GS1_128.drawConvenience()
                        addLog(`drawConvenience("${data}", ${width}, ${height}) å®Ÿè¡Œ`);
                        result = barcode.drawConvenience(data, width, height);
                    } else if (isYubinCustomer) {
                        // éƒµä¾¿ã‚«ã‚¹ã‚¿ãƒ: draw(code, height) â† é«˜ã•ã®ã¿æŒ‡å®š
                        addLog(`draw("${data}", ${height}) å®Ÿè¡Œ (éƒµä¾¿ã‚«ã‚¹ã‚¿ãƒã¯é«˜ã•ã®ã¿æŒ‡å®š)`);
                        result = barcode.draw(data, height);
                    } else if (isGS1DataBarExpanded && document.getElementById('typeDatabarExpanded').value === 'STACKED') {
                        // DataBar Expanded Stacked: drawStacked()
                        addLog(`drawStacked("${data}", ${width}, ${height}) å®Ÿè¡Œ`);
                        result = barcode.drawStacked(data, width, height);
                    } else {
                        // é€šå¸¸ã®draw
                        addLog(`draw("${data}", ${width}, ${height}) å®Ÿè¡Œ`);
                        result = barcode.draw(data, width, height);
                    }
                    addLog(`âœ… draw()å®Œäº† - æˆ»ã‚Šå€¤ã®å‹: ${typeof result}`);
                    addLog(`ãƒ‡ãƒ¼ã‚¿é•·: ${result ? result.length : 0}`);
                    
                    if (result) {
                        addLog(`ãƒ‡ãƒ¼ã‚¿ã®æœ€åˆã®50æ–‡å­—: ${result.substring(0, 50)}`);
                        if (outputFormat === 'png') {
                            addLog(`data:imageã§å§‹ã¾ã‚‹: ${result.startsWith('data:image') ? 'ã¯ã„' : 'ã„ã„ãˆ'}`);
                        } else {
                            addLog(`<svgã§å§‹ã¾ã‚‹: ${result.includes('<svg') ? 'ã¯ã„' : 'ã„ã„ãˆ'}`);
                        }
                    }
                } catch (error) {
                    // â˜…Barcode.WASMâ˜… ã‚¨ãƒ©ãƒ¼å–å¾—
                    // barcode.draw()ãŒä¾‹å¤–ã‚’æŠ•ã’ãŸå ´åˆã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å–å¾—
                    const errorMsg = error.message || error.toString();
                    addLog(`âŒ ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚¨ãƒ©ãƒ¼: ${errorMsg}`, true);
                    
                    document.getElementById('result').innerHTML = 
                        `<p class="error"><strong>ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚¨ãƒ©ãƒ¼</strong><br>${errorMsg}</p>`;
                    
                    // â˜…Barcode.WASMâ˜… ãƒ¡ãƒ¢ãƒªè§£æ”¾ï¼ˆé‡è¦ï¼ï¼‰
                    addLog('Step 7: ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ä¸­...');
                    barcode.delete();
                    addLog('âœ… ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†');
                    return;
                }

                // çµæœè¡¨ç¤º
                addLog('Step 6: ç”»åƒè¡¨ç¤ºä¸­...');
                
                if (!result || result.length === 0) {
                    addLog('âŒ ç”Ÿæˆãƒ‡ãƒ¼ã‚¿ãŒç©ºã§ã™', true);
                    addLog('ğŸ’¡ ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼ˆF12ã‚­ãƒ¼ï¼‰ã«è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºåŠ›ã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™', true);
                    
                    document.getElementById('result').innerHTML = 
                        '<p class="error"><strong>ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚¨ãƒ©ãƒ¼</strong><br>ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚<br><small>ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼ˆF12ã‚­ãƒ¼ï¼‰ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</small></p>';
                    
                    addLog('Step 7: ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ä¸­...');
                    barcode.delete();
                    addLog('âœ… ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†');
                    return;
                }
                
                // å‡ºåŠ›ãƒ¢ãƒ¼ãƒ‰å–å¾—ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶/PDFï¼‰
                const outputMode = document.querySelector('input[name="outputMode1d"]:checked').value;
                addLog(`å‡ºåŠ›ãƒ¢ãƒ¼ãƒ‰: ${outputMode === 'browser' ? 'ãƒ–ãƒ©ã‚¦ã‚¶è¡¨ç¤º' : 'PDFå‡ºåŠ›'}`);

                if (outputMode === 'pdf') {
                    // ============================================================
                    // PDFå‡ºåŠ›ï¼ˆjsPDFãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ï¼‰
                    // ============================================================
                    await generatePDF1D(result, outputFormat, width, height, rotateAngle, xPos, yPos);
                } else {
                    // ãƒ–ãƒ©ã‚¦ã‚¶ç›´æ¥è¡¨ç¤ºï¼ˆçµ±ä¸€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰
                    const rotateStyle = rotateAngle !== 0 ? `transform: rotate(${rotateAngle}deg);` : '';
                    const formatLabel = outputFormat === 'svg' ? 'âœ… SVGãƒ™ã‚¯ã‚¿ãƒ¼ç”»åƒ' : 'ğŸ“· PNGç”»åƒ';
                    const formatClass = outputFormat === 'svg' ? 'svg' : 'png';
                    const fileExt = outputFormat === 'svg' ? 'svg' : 'png';
                    
                    // SVGç”¨ã®BlobURLä½œæˆ
                    let downloadUrl = result;
                    if (outputFormat === 'svg') {
                        const svgBlob = new Blob([result], { type: 'image/svg+xml;charset=utf-8' });
                        downloadUrl = URL.createObjectURL(svgBlob);
                    }
                    
                    // PNGç”»åƒã‚µã‚¤ã‚ºãƒ­ã‚°
                    if (outputFormat === 'png') {
                        const img = new Image();
                        img.onload = function() {
                            addLog(`ğŸ“ ç”Ÿæˆã•ã‚ŒãŸç”»åƒã®å®Ÿéš›ã®ã‚µã‚¤ã‚º: ${img.width}x${img.height}px`);
                        };
                        img.src = result;
                    }
                    
                    const contentHtml = outputFormat === 'svg' 
                        ? result 
                        : `<img src="${result}" alt="ç”Ÿæˆã•ã‚ŒãŸãƒãƒ¼ã‚³ãƒ¼ãƒ‰" style="image-rendering: pixelated;">`;
                    
                    document.getElementById('result').innerHTML = 
                        `<div class="toolbar">
                            <span class="format-label ${formatClass}">${formatLabel}</span>
                            <a href="${downloadUrl}" download="barcode_${type}.${fileExt}" class="action-btn download">ğŸ’¾ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>
                            <span class="info-text">ã‚µã‚¤ã‚º: ${width}x${height}px | ä½ç½®: (${xPos}, ${yPos}) | å›è»¢: ${rotateAngle}Â°</span>
                        </div>
                        <div class="canvas-container">
                            <div class="canvas-inner">
                                <div class="barcode-element" style="left:${xPos}px; top:${yPos}px; ${rotateStyle}">
                                    ${contentHtml}
                                </div>
                            </div>
                        </div>`;
                    addLog(`âœ…âœ…âœ… ${outputFormat.toUpperCase()}ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”ŸæˆæˆåŠŸï¼`);
                }

                // â˜…Barcode.WASMâ˜… ãƒ¡ãƒ¢ãƒªè§£æ”¾ï¼ˆé‡è¦ï¼ï¼‰
                // WASMã§ä½œæˆã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯å¿…ãšdelete()ã§è§£æ”¾ã™ã‚‹
                addLog('Step 7: ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ä¸­...');
                barcode.delete();
                addLog('âœ… ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†');
                addLog('=== å‡¦ç†å®Œäº† ===');

            } catch (error) {
                addLog(`âŒ ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ: ${error.message}`, true);
                addLog(`ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹: ${error.stack}`, true);
                console.error('ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
                document.getElementById('result').innerHTML = 
                    `<p class="error">ã‚¨ãƒ©ãƒ¼: ${error.message}</p>`;
            }
        };

        /**
         * GS1ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¿ãƒ¼ãƒ³é©ç”¨ï¼ˆ2æ¬¡å…ƒãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”¨ï¼‰
         */
        window.applyGS1Pattern2D = function() {
            const select = document.getElementById('gs1PatternSelect_DataMatrix');
            const dataInput = document.getElementById('data2d');
            
            if (select && dataInput && select.value && select.value !== '') {
                dataInput.value = select.value;
                select.selectedIndex = 0;
            }
        };

        // ============================================================
        // 2æ¬¡å…ƒãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
        // ============================================================
        /**
         * 2æ¬¡å…ƒãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¦resultã‚¨ãƒªã‚¢ã«è¡¨ç¤º
         * 
         * ã€Barcode.WASM ä½¿ç”¨æ‰‹é †ã€‘
         * 1. new barcodeModule.XXX() ã§ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆï¼ˆQR/DataMatrix/PDF417ï¼‰
         * 2. setOutputFormat("png" or "svg") ã§å‡ºåŠ›å½¢å¼ã‚’è¨­å®š
         * 3. setForegroundColor() / setBackgroundColor() ã§è‰²è¨­å®š
         * 4. setStringEncoding("utf-8" or "shift-jis") ã§æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¨­å®š
         * 5. å„ãƒãƒ¼ã‚³ãƒ¼ãƒ‰å›ºæœ‰ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¨­å®š
         * 6. draw(data, size) ã§ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”Ÿæˆï¼ˆ2Dã¯æ­£æ–¹å½¢ãªã®ã§sizeã®ã¿ï¼‰
         * 7. PNG: Base64æ–‡å­—åˆ—ãŒè¿”ã‚‹ / SVG: SVGæ–‡å­—åˆ—ãŒè¿”ã‚‹
         * 8. barcode.delete() ã§ãƒ¡ãƒ¢ãƒªè§£æ”¾ï¼ˆé‡è¦ï¼ï¼‰
         */
        window.generate2D = async function() {
            clearLog();
            addLog('=== 2æ¬¡å…ƒãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”Ÿæˆé–‹å§‹ ===');
            
            // â˜…Barcode.WASMâ˜… WASMãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®èª­ã¿è¾¼ã¿ç¢ºèª
            if (!barcodeModule) {
                addLog('âŒ WASMãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“', true);
                document.getElementById('result').innerHTML = 
                    '<p class="error">WASMãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒã¾ã èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“</p>';
                return;
            }
            addLog('âœ… WASMãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç¢ºèªOK');

            const type = document.getElementById('barcode2dType').value;
            const data = document.getElementById('data2d').value;
            const size = parseInt(document.getElementById('size2d').value);

            // â˜…åº§æ¨™ãƒ»å›è»¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å–å¾—â˜…
            const xPos = parseInt(document.getElementById('x2d').value) || 0;
            const yPos = parseInt(document.getElementById('y2d').value) || 0;
            const rotateAngle = parseInt(document.getElementById('rotateAngle2d').value) || 0;
            addLog(`Xåº§æ¨™: ${xPos}, Yåº§æ¨™: ${yPos}`);
            addLog(`å›è»¢è§’åº¦: ${rotateAngle}Â°`);

            // â˜…å‡ºåŠ›å½¢å¼ã®å–å¾—â˜…ï¼ˆã‚¿ãƒ–ä¸Šéƒ¨ã®å…±é€šãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã‹ã‚‰ï¼‰
            const outputFormat = document.querySelector('input[name="outputFormat"]:checked').value;
            addLog(`å‡ºåŠ›å½¢å¼: ${outputFormat.toUpperCase()}`);

            addLog(`ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç¨®é¡: ${type}`);
            addLog(`ãƒ‡ãƒ¼ã‚¿: ${data}`);
            addLog(`ã‚µã‚¤ã‚º: ${size}px`);

            if (!data) {
                addLog('âŒ ãƒ‡ãƒ¼ã‚¿ãŒç©ºã§ã™', true);
                alert('ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            document.getElementById('result').innerHTML = '<p class="loading">ç”Ÿæˆä¸­...</p>';

            try {
                // â˜…Barcode.WASMâ˜… ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
                addLog('Step 1: ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆä¸­...');
                addLog(`new barcodeModule.${type}() å®Ÿè¡Œ`);
                const barcode = new barcodeModule[type]();
                addLog('âœ… ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆæˆåŠŸ');
                addLog(`ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å‹: ${typeof barcode}`);

                // â˜…Barcode.WASMâ˜… å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆè¨­å®šï¼ˆPNG/SVGåˆ‡ã‚Šæ›¿ãˆï¼‰
                addLog('Step 2: å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆè¨­å®šä¸­...');
                barcode.setOutputFormat(outputFormat);
                addLog(`âœ… å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆè¨­å®šå®Œäº†: ${outputFormat}`);

                // â˜…Barcode.WASMâ˜… å…±é€šãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¨­å®š
                addLog('Step 3: å…±é€šãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¨­å®šä¸­...');
                
                const foreColor = hexToRgb(document.getElementById('foreColor2d').value);
                const backColor = hexToRgb(document.getElementById('backColor2d').value);
                addLog(`å‰æ™¯è‰²: RGB(${foreColor.r}, ${foreColor.g}, ${foreColor.b})`);
                addLog(`èƒŒæ™¯è‰²: RGB(${backColor.r}, ${backColor.g}, ${backColor.b})`);
                
                barcode.setForegroundColor(foreColor.r, foreColor.g, foreColor.b, 255);
                addLog('âœ… å‰æ™¯è‰²è¨­å®šå®Œäº†');
                
                barcode.setBackgroundColor(backColor.r, backColor.g, backColor.b, 255);
                addLog('âœ… èƒŒæ™¯è‰²è¨­å®šå®Œäº†');
                
                // æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¨­å®šï¼ˆæ—¥æœ¬èªå¯¾å¿œï¼‰
                const encoding = document.getElementById('encoding2d').value;
                addLog(`æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°: ${encoding}`);
                barcode.setStringEncoding(encoding);
                addLog('âœ… ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¨­å®šå®Œäº†');

                // â˜…Barcode.WASMâ˜… å›ºæœ‰ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¨­å®š
                addLog('Step 4: å›ºæœ‰ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¨­å®šä¸­...');
                
                // QRã‚³ãƒ¼ãƒ‰å›ºæœ‰è¨­å®š
                if (type === 'QR') {
                    const errorLevel = document.getElementById('errorLevel2d');
                    const version = document.getElementById('version2d');
                    const encodeMode = document.getElementById('encodeMode2d');
                    
                    if (errorLevel) {
                        addLog(`èª¤ã‚Šè¨‚æ­£ãƒ¬ãƒ™ãƒ«: ${errorLevel.value}`);
                        barcode.setErrorCorrectionLevel(errorLevel.value);
                        addLog('âœ… èª¤ã‚Šè¨‚æ­£ãƒ¬ãƒ™ãƒ«è¨­å®šå®Œäº†');
                    }
                    if (version) {
                        const versionValue = parseInt(version.value);
                        addLog(`ãƒãƒ¼ã‚¸ãƒ§ãƒ³: ${versionValue}`);
                        barcode.setVersion(versionValue);
                        addLog('âœ… ãƒãƒ¼ã‚¸ãƒ§ãƒ³è¨­å®šå®Œäº†');
                    }
                    if (encodeMode) {
                        addLog(`ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ‰: ${encodeMode.value}`);
                        barcode.setEncodeMode(encodeMode.value);
                        addLog('âœ… ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ‰è¨­å®šå®Œäº†');
                    }
                }

                // DataMatrixå›ºæœ‰è¨­å®š
                // â˜…â˜…â˜… ãƒ‡ãƒãƒƒã‚°: setCodeSize/setEncodeSchemeã‚’ä¸€æ™‚çš„ã«ç„¡åŠ¹åŒ– â˜…â˜…â˜…
                if (type === 'DataMatrix') {
                    const codeSize = document.getElementById('codeSize2d');
                    const encodeScheme = document.getElementById('encodeScheme2d');
                    
                    if (codeSize) {
                        addLog(`ã‚³ãƒ¼ãƒ‰ã‚µã‚¤ã‚º: ${codeSize.value} (â€»è¨­å®šã‚¹ã‚­ãƒƒãƒ—)`);
                        barcode.setCodeSize(codeSize.value);  // ä¸€æ™‚ç„¡åŠ¹åŒ–
                        addLog('âœ… ã‚³ãƒ¼ãƒ‰ã‚µã‚¤ã‚ºè¨­å®šå®Œäº†');
                    }
                    if (encodeScheme) {
                        addLog(`ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚¹ã‚­ãƒ¼ãƒ : ${encodeScheme.value} (â€»è¨­å®šã‚¹ã‚­ãƒƒãƒ—)`);
                        barcode.setEncodeScheme(encodeScheme.value);  // ä¸€æ™‚ç„¡åŠ¹åŒ–
                        addLog('âœ… ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚¹ã‚­ãƒ¼ãƒ è¨­å®šå®Œäº†');
                    }
                }

                // PDF417å›ºæœ‰è¨­å®š
                if (type === 'PDF417') {
                    const errorLevel = document.getElementById('errorLevel2d');
                    const columns = document.getElementById('columns2d');
                    const rows = document.getElementById('rows2d');
                    const aspectRatio = document.getElementById('aspectRatio2d');
                    const yHeight = document.getElementById('yHeight2d');
                    
                    if (errorLevel) {
                        const levelValue = parseInt(errorLevel.value);
                        addLog(`èª¤ã‚Šè¨‚æ­£ãƒ¬ãƒ™ãƒ«: ${levelValue}`);
                        barcode.setErrorLevel(levelValue);
                        addLog('âœ… èª¤ã‚Šè¨‚æ­£ãƒ¬ãƒ™ãƒ«è¨­å®šå®Œäº†');
                    }
                    if (columns) {
                        const colValue = parseInt(columns.value);
                        addLog(`åˆ—æ•°: ${colValue}`);
                        barcode.setColumns(colValue);
                        addLog('âœ… åˆ—æ•°è¨­å®šå®Œäº†');
                    }
                    if (rows) {
                        const rowValue = parseInt(rows.value);
                        addLog(`è¡Œæ•°: ${rowValue}`);
                        barcode.setRows(rowValue);
                        addLog('âœ… è¡Œæ•°è¨­å®šå®Œäº†');
                    }
                    if (aspectRatio) {
                        const ratioValue = parseFloat(aspectRatio.value);
                        addLog(`ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”: ${ratioValue}`);
                        barcode.setAspectRatio(ratioValue);
                        addLog('âœ… ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”è¨­å®šå®Œäº†');
                    }
                    if (yHeight) {
                        const heightValue = parseInt(yHeight.value);
                        addLog(`Yã®é«˜ã•: ${heightValue}`);
                        barcode.setYHeight(heightValue);
                        addLog('âœ… Yã®é«˜ã•è¨­å®šå®Œäº†');
                    }
                }

                // â˜…Barcode.WASMâ˜… ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
                addLog('Step 5: ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”Ÿæˆä¸­...');
                
                addLog(`draw("${data}", ${size}) å®Ÿè¡Œ`);
                
                let result;
                try {
                    result = barcode.draw(data, size);
                    addLog(`âœ… draw()å®Œäº† - æˆ»ã‚Šå€¤ã®å‹: ${typeof result}`);
                    addLog(`ãƒ‡ãƒ¼ã‚¿é•·: ${result ? result.length : 0}`);
                    
                    if (result) {
                        addLog(`ãƒ‡ãƒ¼ã‚¿ã®æœ€åˆã®50æ–‡å­—: ${result.substring(0, 50)}`);
                        if (outputFormat === 'png') {
                            addLog(`data:imageã§å§‹ã¾ã‚‹: ${result.startsWith('data:image') ? 'ã¯ã„' : 'ã„ã„ãˆ'}`);
                        } else {
                            addLog(`<svgã§å§‹ã¾ã‚‹: ${result.includes('<svg') ? 'ã¯ã„' : 'ã„ã„ãˆ'}`);
                        }
                    }
                } catch (error) {
                    // â˜…Barcode.WASMâ˜… ã‚¨ãƒ©ãƒ¼å–å¾—
                    const errorMsg = error.message || error.toString();
                    addLog(`âŒ ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚¨ãƒ©ãƒ¼: ${errorMsg}`, true);
                    
                    document.getElementById('result').innerHTML = 
                        `<p class="error"><strong>ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚¨ãƒ©ãƒ¼</strong><br>${errorMsg}</p>`;
                    
                    addLog('Step 7: ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ä¸­...');
                    barcode.delete();
                    addLog('âœ… ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†');
                    return;
                }

                // çµæœè¡¨ç¤º
                addLog('Step 6: ç”»åƒè¡¨ç¤ºä¸­...');
                
                if (!result || result.length === 0) {
                    addLog('âŒ ç”Ÿæˆãƒ‡ãƒ¼ã‚¿ãŒç©ºã§ã™', true);
                    addLog('ğŸ’¡ ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼ˆF12ã‚­ãƒ¼ï¼‰ã«è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºåŠ›ã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™', true);
                    
                    document.getElementById('result').innerHTML = 
                        '<p class="error"><strong>ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚¨ãƒ©ãƒ¼</strong><br>ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚<br><small>ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼ˆF12ã‚­ãƒ¼ï¼‰ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</small></p>';
                    
                    addLog('Step 7: ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ä¸­...');
                    barcode.delete();
                    addLog('âœ… ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†');
                    return;
                }
                
                // å‡ºåŠ›ãƒ¢ãƒ¼ãƒ‰å–å¾—ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶/PDFï¼‰
                const outputMode = document.querySelector('input[name="outputMode2d"]:checked').value;
                addLog(`å‡ºåŠ›ãƒ¢ãƒ¼ãƒ‰: ${outputMode === 'browser' ? 'ãƒ–ãƒ©ã‚¦ã‚¶è¡¨ç¤º' : 'PDFå‡ºåŠ›'}`);

                if (outputMode === 'pdf') {
                    // ============================================================
                    // PDFå‡ºåŠ›ï¼ˆjsPDFãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ï¼‰
                    // ============================================================
                    await generatePDF2D(result, outputFormat, size, rotateAngle, xPos, yPos);
                } else {
                    // ãƒ–ãƒ©ã‚¦ã‚¶ç›´æ¥è¡¨ç¤ºï¼ˆã‚­ãƒ£ãƒ³ãƒã‚¹é…ç½®æ–¹å¼ï¼‰
                    // â˜…å‡ºåŠ›å½¢å¼ã«å¿œã˜ãŸè¡¨ç¤ºï¼ˆçµ±ä¸€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰â˜…
                    const rotateStyle = rotateAngle !== 0 ? `transform: rotate(${rotateAngle}deg);` : '';
                    const formatLabel = outputFormat === 'svg' ? 'âœ… SVGãƒ™ã‚¯ã‚¿ãƒ¼ç”»åƒ' : 'ğŸ“· PNGç”»åƒ';
                    const formatClass = outputFormat === 'svg' ? 'svg' : 'png';
                    const fileExt = outputFormat === 'svg' ? 'svg' : 'png';
                    
                    // SVGç”¨ã®BlobURLä½œæˆ
                    let downloadUrl = result;
                    if (outputFormat === 'svg') {
                        const svgBlob = new Blob([result], { type: 'image/svg+xml;charset=utf-8' });
                        downloadUrl = URL.createObjectURL(svgBlob);
                    }
                    
                    // PNGç”»åƒã‚µã‚¤ã‚ºãƒ­ã‚°
                    if (outputFormat === 'png') {
                        const img = new Image();
                        img.onload = function() {
                            addLog(`ğŸ“ ç”Ÿæˆã•ã‚ŒãŸç”»åƒã®å®Ÿéš›ã®ã‚µã‚¤ã‚º: ${img.width}x${img.height}px`);
                        };
                        img.src = result;
                    }
                    
                    const contentHtml = outputFormat === 'svg' 
                        ? result 
                        : `<img src="${result}" alt="ç”Ÿæˆã•ã‚ŒãŸãƒãƒ¼ã‚³ãƒ¼ãƒ‰" style="image-rendering: pixelated;">`;
                    
                    document.getElementById('result').innerHTML = 
                        `<div class="toolbar">
                            <span class="format-label ${formatClass}">${formatLabel}</span>
                            <a href="${downloadUrl}" download="barcode_${type}.${fileExt}" class="action-btn download">ğŸ’¾ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>
                            <span class="info-text">ã‚µã‚¤ã‚º: ${size}x${size}px | ä½ç½®: (${xPos}, ${yPos}) | å›è»¢: ${rotateAngle}Â°</span>
                        </div>
                        <div class="canvas-container">
                            <div class="canvas-inner">
                                <div class="barcode-element" style="left:${xPos}px; top:${yPos}px; ${rotateStyle}">
                                    ${contentHtml}
                                </div>
                            </div>
                        </div>`;
                    addLog(`âœ…âœ…âœ… ${outputFormat.toUpperCase()}ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”ŸæˆæˆåŠŸï¼`);
                }

                // â˜…Barcode.WASMâ˜… ãƒ¡ãƒ¢ãƒªè§£æ”¾ï¼ˆé‡è¦ï¼ï¼‰
                addLog('Step 7: ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ä¸­...');
                barcode.delete();
                addLog('âœ… ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†');
                addLog('=== å‡¦ç†å®Œäº† ===');

            } catch (error) {
                addLog(`âŒ ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ: ${error.message}`, true);
                addLog(`ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹: ${error.stack}`, true);
                console.error('ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
                document.getElementById('result').innerHTML = 
                    `<p class="error">ã‚¨ãƒ©ãƒ¼: ${error.message}</p>`;
            }
        };

        // ============================================================
        // ç‰¹æ®Šãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
        // Gitãƒªãƒãƒ¼ã‚¹ç‰ˆã®generate1Dã®ConvenienceStore/YubinCustomerå‡¦ç†ã¨åŒã˜ãƒ­ã‚¸ãƒƒã‚¯
        // ============================================================
        window.generateSpecial = async function() {
            clearLog();
            addLog('=== ç‰¹æ®Šãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”Ÿæˆé–‹å§‹ ===');
            
            const type = document.getElementById('barcodeSpecialType').value;
            
            // WASMãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®èª­ã¿è¾¼ã¿ç¢ºèª
            if (!barcodeModule) {
                addLog('âŒ WASMãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“', true);
                document.getElementById('result').innerHTML = 
                    '<p class="error">WASMãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒã¾ã èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“</p>';
                return;
            }
            addLog('âœ… WASMãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç¢ºèªOK');

            const data = document.getElementById('dataSpecial').value;
            const width = parseInt(document.getElementById('widthSpecial').value);
            const height = parseInt(document.getElementById('heightSpecial').value);

            // â˜…åº§æ¨™ãƒ»å›è»¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å–å¾—â˜…
            const xPos = parseInt(document.getElementById('xSpecial').value) || 0;
            const yPos = parseInt(document.getElementById('ySpecial').value) || 0;
            const rotateAngle = parseInt(document.getElementById('rotateAngleSpecial').value) || 0;
            addLog(`Xåº§æ¨™: ${xPos}, Yåº§æ¨™: ${yPos}`);
            addLog(`å›è»¢è§’åº¦: ${rotateAngle}Â°`);

            // å‡ºåŠ›å½¢å¼ã®å–å¾—ï¼ˆã‚¿ãƒ–ä¸Šéƒ¨ã®å…±é€šãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã‹ã‚‰ï¼‰
            const outputFormat = document.querySelector('input[name="outputFormat"]:checked').value;

            addLog(`ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç¨®é¡: ${type}`);
            addLog(`ãƒ‡ãƒ¼ã‚¿: ${data}`);
            addLog(`ã‚µã‚¤ã‚º: ${width}x${height}px`);
            addLog(`å‡ºåŠ›å½¢å¼: ${outputFormat.toUpperCase()}`);

            if (!data) {
                addLog('âŒ ãƒ‡ãƒ¼ã‚¿ãŒç©ºã§ã™', true);
                alert('ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            document.getElementById('result').innerHTML = '<p class="loading">ç”Ÿæˆä¸­...</p>';

            try {
                addLog('Step 1: ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆä¸­...');
                
                // ç‰¹æ®Šãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã®åˆ¤å®š
                const isConvenienceStore = (type === 'ConvenienceStore');
                const isYubinCustomer = (type === 'YubinCustomer');
                
                // ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
                // ConvenienceStoreã¯GS1_128ã‚¯ãƒ©ã‚¹ã‚’ä½¿ç”¨
                const wasmType = isConvenienceStore ? 'GS1_128' : type;
                addLog(`new barcodeModule.${wasmType}() å®Ÿè¡Œ`);
                const barcode = new barcodeModule[wasmType]();
                addLog('âœ… ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆæˆåŠŸ');

                // å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆè¨­å®š
                addLog('Step 2: å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆè¨­å®šä¸­...');
                barcode.setOutputFormat(outputFormat);
                addLog(`âœ… å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆè¨­å®šå®Œäº†: ${outputFormat}`);

                // å…±é€šãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¨­å®š
                addLog('Step 3: å…±é€šãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¨­å®šä¸­...');
                
                // å‰æ™¯è‰²ãƒ»èƒŒæ™¯è‰²
                const foreColor = hexToRgb(document.getElementById('foreColorSpecial').value);
                const backColor = hexToRgb(document.getElementById('backColorSpecial').value);
                addLog(`å‰æ™¯è‰²: RGB(${foreColor.r}, ${foreColor.g}, ${foreColor.b})`);
                addLog(`èƒŒæ™¯è‰²: RGB(${backColor.r}, ${backColor.g}, ${backColor.b})`);
                
                barcode.setForegroundColor(foreColor.r, foreColor.g, foreColor.b, 255);
                addLog('âœ… å‰æ™¯è‰²è¨­å®šå®Œäº†');
                
                barcode.setBackgroundColor(backColor.r, backColor.g, backColor.b, 255);
                addLog('âœ… èƒŒæ™¯è‰²è¨­å®šå®Œäº†');
                
                // ãƒ”ã‚¯ã‚»ãƒ«èª¿æ•´
                const pxAdjustBlack = parseInt(document.getElementById('pxAdjustBlackSpecial').value);
                const pxAdjustWhite = parseInt(document.getElementById('pxAdjustWhiteSpecial').value);
                addLog(`é»’ãƒãƒ¼èª¿æ•´: ${pxAdjustBlack}px`);
                addLog(`ç™½ã‚¹ãƒšãƒ¼ã‚¹èª¿æ•´: ${pxAdjustWhite}px`);
                barcode.setPxAdjustBlack(pxAdjustBlack);
                barcode.setPxAdjustWhite(pxAdjustWhite);
                addLog('âœ… ãƒ”ã‚¯ã‚»ãƒ«èª¿æ•´è¨­å®šå®Œäº†');
                
                // éƒµä¾¿ã‚«ã‚¹ã‚¿ãƒä»¥å¤–ã¯å¹…ã´ã£ãŸã‚Šè¨­å®šã‚’ã‚µãƒãƒ¼ãƒˆ
                if (!isYubinCustomer) {
                    const fitWidth = document.getElementById('fitWidthSpecial').checked;
                    addLog(`å¹…ã´ã£ãŸã‚Šæç”»: ${fitWidth ? 'ON' : 'OFF'}`);
                    barcode.setFitWidth(fitWidth);
                    addLog('âœ… å¹…è¨­å®šå®Œäº†');
                } else {
                    addLog('â„¹ï¸ éƒµä¾¿ã‚«ã‚¹ã‚¿ãƒãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã¯å¹…ã´ã£ãŸã‚Šè¨­å®šã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“');
                }

                // ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
                addLog('Step 4: ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”Ÿæˆä¸­...');
                
                let result;
                try {
                    // ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç¨®é¡åˆ¥ã®drawå‘¼ã³å‡ºã—
                    if (isConvenienceStore) {
                        // ã‚³ãƒ³ãƒ“ãƒ‹ãƒãƒ¼ã‚³ãƒ¼ãƒ‰: GS1_128.drawConvenience()
                        addLog(`drawConvenience("${data}", ${width}, ${height}) å®Ÿè¡Œ`);
                        result = barcode.drawConvenience(data, width, height);
                    } else if (isYubinCustomer) {
                        // éƒµä¾¿ã‚«ã‚¹ã‚¿ãƒ: draw(code, height) â† å¼•æ•°2ã¤ã®ã¿
                        addLog(`draw("${data}", ${height}) å®Ÿè¡Œ (éƒµä¾¿ã‚«ã‚¹ã‚¿ãƒã¯é«˜ã•ã®ã¿æŒ‡å®š)`);
                        result = barcode.draw(data, height);
                    }
                    addLog(`âœ… draw()å®Œäº† - æˆ»ã‚Šå€¤ã®å‹: ${typeof result}`);
                    addLog(`ãƒ‡ãƒ¼ã‚¿é•·: ${result ? result.length : 0}`);
                    
                    if (result) {
                        addLog(`ãƒ‡ãƒ¼ã‚¿ã®æœ€åˆã®50æ–‡å­—: ${result.substring(0, 50)}`);
                        if (outputFormat === 'png') {
                            addLog(`data:imageã§å§‹ã¾ã‚‹: ${result.startsWith('data:image') ? 'ã¯ã„' : 'ã„ã„ãˆ'}`);
                        } else {
                            addLog(`<svgã§å§‹ã¾ã‚‹: ${result.includes('<svg') ? 'ã¯ã„' : 'ã„ã„ãˆ'}`);
                        }
                    }
                } catch (error) {
                    const errorMsg = error.message || error.toString();
                    addLog(`âŒ ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚¨ãƒ©ãƒ¼: ${errorMsg}`, true);
                    
                    document.getElementById('result').innerHTML = 
                        `<p class="error"><strong>ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚¨ãƒ©ãƒ¼</strong><br>${errorMsg}</p>`;
                    
                    addLog('Step 6: ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ä¸­...');
                    barcode.delete();
                    addLog('âœ… ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†');
                    return;
                }

                // çµæœè¡¨ç¤º
                addLog('Step 5: ç”»åƒè¡¨ç¤ºä¸­...');
                
                // çµæœã®æ¤œè¨¼
                const isValidResult = result && result !== '' && 
                  !result.startsWith('Error') && 
                  (result.startsWith('data:image') || result.includes('<svg') || result.startsWith('<?xml'));
                
                // æ•°å€¤ã®ã¿ã®å ´åˆã¯ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰
                const isErrorCode = /^\d+$/.test(result);
                
                if (!isValidResult || isErrorCode || !result || result.length === 0) {
                    let errorDetail = isErrorCode ? `ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰: ${result}` : 'ç”Ÿæˆãƒ‡ãƒ¼ã‚¿ãŒç©ºã§ã™';
                    
                    addLog(`âŒ ${errorDetail}`, true);
                    addLog('ğŸ’¡ ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼ˆF12ã‚­ãƒ¼ï¼‰ã«è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºåŠ›ã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™', true);
                    
                    document.getElementById('result').innerHTML = 
                        `<p class="error"><strong>ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚¨ãƒ©ãƒ¼</strong><br>${errorDetail}<br><small>ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼ˆF12ã‚­ãƒ¼ï¼‰ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</small></p>`;
                    
                    addLog('Step 6: ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ä¸­...');
                    barcode.delete();
                    addLog('âœ… ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†');
                    return;
                }
                
                // å‡ºåŠ›ãƒ¢ãƒ¼ãƒ‰å–å¾—ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶/PDFï¼‰
                const outputMode = document.querySelector('input[name="outputModeSpecial"]:checked').value;
                addLog(`å‡ºåŠ›ãƒ¢ãƒ¼ãƒ‰: ${outputMode === 'browser' ? 'ãƒ–ãƒ©ã‚¦ã‚¶è¡¨ç¤º' : 'PDFå‡ºåŠ›'}`);

                if (outputMode === 'pdf') {
                    // PDFå‡ºåŠ›ï¼ˆgeneratePDF1Dã‚’ä½¿ç”¨ï¼‰
                    let actualWidth = width;
                    let actualHeight = height;
                    if (isYubinCustomer) {
                        // éƒµä¾¿ã‚«ã‚¹ã‚¿ãƒ: å¹…ã¯WASMè¨ˆç®—å¼ã«åˆã‚ã›ã‚‹
                        // calcWidth = xPitch * 67 + xBar + 1 = (height/3)*67 + (height/6) + 1
                        actualWidth = Math.round(actualHeight / 3 * 67 + actualHeight / 6 + 1);
                    }
                    await generatePDF1D(result, outputFormat, actualWidth, actualHeight, rotateAngle, xPos, yPos);
                    addLog('âœ… PDFå‡ºåŠ›å®Œäº†');
                } else {
                    // ãƒ–ãƒ©ã‚¦ã‚¶ç›´æ¥è¡¨ç¤ºï¼ˆçµ±ä¸€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰
                    const rotateStyle = rotateAngle !== 0 ? `transform: rotate(${rotateAngle}deg);` : '';
                    
                    // å®Ÿéš›ã®ã‚µã‚¤ã‚ºï¼ˆéƒµä¾¿ã‚«ã‚¹ã‚¿ãƒã¯é«˜ã•ã®ã¿æŒ‡å®šã®ãŸã‚å¹…ã‚’è¨ˆç®—ï¼‰
                    let displayWidth = width;
                    let displayHeight = height;
                    if (isYubinCustomer) {
                        // éƒµä¾¿ã‚«ã‚¹ã‚¿ãƒ: å¹…ã¯WASMè¨ˆç®—å¼ã«åˆã‚ã›ã‚‹
                        displayWidth = Math.round(displayHeight / 3 * 67 + displayHeight / 6 + 1);
                    }
                    
                    const formatLabel = outputFormat === 'svg' ? 'âœ… SVGãƒ™ã‚¯ã‚¿ãƒ¼ç”»åƒ' : 'ğŸ“· PNGç”»åƒ';
                    const formatClass = outputFormat === 'svg' ? 'svg' : 'png';
                    const fileExt = outputFormat === 'svg' ? 'svg' : 'png';
                    
                    // SVGç”¨ã®BlobURLä½œæˆ
                    let downloadUrl = result;
                    if (outputFormat === 'svg') {
                        const svgBlob = new Blob([result], { type: 'image/svg+xml;charset=utf-8' });
                        downloadUrl = URL.createObjectURL(svgBlob);
                    }
                    
                    const contentHtml = outputFormat === 'svg' 
                        ? result 
                        : `<img src="${result}" alt="ç”Ÿæˆã•ã‚ŒãŸãƒãƒ¼ã‚³ãƒ¼ãƒ‰" style="image-rendering: pixelated;">`;
                    
                    document.getElementById('result').innerHTML = 
                        `<div class="toolbar">
                            <span class="format-label ${formatClass}">${formatLabel}</span>
                            <a href="${downloadUrl}" download="barcode_${type}.${fileExt}" class="action-btn download">ğŸ’¾ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>
                            <span class="info-text">ã‚µã‚¤ã‚º: ${displayWidth}x${displayHeight}px | ä½ç½®: (${xPos}, ${yPos}) | å›è»¢: ${rotateAngle}Â°</span>
                        </div>
                        <div class="canvas-container">
                            <div class="canvas-inner">
                                <div class="barcode-element" style="left:${xPos}px; top:${yPos}px; ${rotateStyle}">
                                    ${contentHtml}
                                </div>
                            </div>
                        </div>`;
                    addLog(`âœ…âœ…âœ… ${outputFormat.toUpperCase()}ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”ŸæˆæˆåŠŸï¼`);
                }

                // ãƒ¡ãƒ¢ãƒªè§£æ”¾
                addLog('Step 6: ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ä¸­...');
                barcode.delete();
                addLog('âœ… ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†');
                addLog('=== å‡¦ç†å®Œäº† ===');

            } catch (error) {
                addLog(`âŒ ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ: ${error.message}`, true);
                addLog(`ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹: ${error.stack}`, true);
                console.error('ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
                document.getElementById('result').innerHTML = 
                    `<p class="error">ã‚¨ãƒ©ãƒ¼: ${error.message}</p>`;
            }
        };

        // ============================================================
        // PDFå‡ºåŠ›é–¢æ•°ï¼ˆjsPDF + svg2pdf.js ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ï¼‰
        // ============================================================
        // ä»¥ä¸‹ã®PDFç”Ÿæˆæ©Ÿèƒ½ã¯ã€Barcode.WASMã®æ©Ÿèƒ½ã§ã¯ãªãã€
        // ç”Ÿæˆã—ãŸãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”»åƒã‚’PDFå½¢å¼ã§å‡ºåŠ›ã™ã‚‹ãŸã‚ã®è£œåŠ©æ©Ÿèƒ½ã§ã™ã€‚
        // jsPDFï¼ˆhttps://github.com/parallax/jsPDFï¼‰ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚
        // SVGå½¢å¼ã®PDFå‡ºåŠ›ã«ã¯svg2pdf.jsï¼ˆhttps://github.com/yWorks/svg2pdf.jsï¼‰ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚
        // 
        // ã“ã®ãƒ‡ãƒ¢ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã¯ã€ä»¥ä¸‹ã®å›ºå®šå€¤ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ï¼š
        // - ç”¨ç´™ã‚µã‚¤ã‚º: A4
        // - å‡ºåŠ›åº§æ¨™: x=10mm, y=10mm
        // - ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚µã‚¤ã‚º: ç”»é¢æŒ‡å®šã®pxå€¤ã‹ã‚‰è‡ªå‹•æ›ç®—ï¼ˆ96dpiåŸºæº–ï¼‰
        // ============================================================

        // px â†’ mm å¤‰æ›ï¼ˆ96dpiåŸºæº–: 1inch = 25.4mm, 96px = 1inchï¼‰
        const pxToMm = (px) => px * 25.4 / 96;

        /**
         * SVGæ–‡å­—åˆ—ã‹ã‚‰SVG DOMè¦ç´ ã‚’ä½œæˆ
         * @param {string} svgString - SVGæ–‡å­—åˆ—
         * @returns {SVGElement} SVG DOMè¦ç´ 
         */
        function createSvgElement(svgString) {
            const parser = new DOMParser();
            const doc = parser.parseFromString(svgString, 'image/svg+xml');
            return doc.documentElement;
        }

        /**
         * SVGã‚’PDFäº’æ›å½¢å¼ã«å¤‰æ›
         * 
         * ã€ãªãœã“ã®å‡¦ç†ãŒå¿…è¦ï¼Ÿã€‘
         * Barcode.WASMãŒå‡ºåŠ›ã™ã‚‹SVGã¯ã€W3Cæ¨™æº–ä»•æ§˜ã«æº–æ‹ ã—ãŸæ­£ã—ã„SVGã§ã™ã€‚
         * ã—ã‹ã—ã€svg2pdf.jsãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒ dominant-baseline å±æ€§ã«æœªå¯¾å¿œã®ãŸã‚ã€
         * PDFå¤‰æ›æ™‚ã«ãƒ†ã‚­ã‚¹ãƒˆä½ç½®ãŒãšã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚
         * 
         * ã“ã®é–¢æ•°ã¯ã€svg2pdf.jsã«æ¸¡ã™å‰ã«SVGã‚’ã€Œç¿»è¨³ã€ã—ã¦ã€
         * åŒã˜è¦‹ãŸç›®ã«ãªã‚‹ã‚ˆã†yåº§æ¨™ã‚’èª¿æ•´ã—ã¾ã™ã€‚
         * ãƒ–ãƒ©ã‚¦ã‚¶è¡¨ç¤ºç”¨ã®SVGã«ã¯å½±éŸ¿ã—ã¾ã›ã‚“â™ª
         * 
         * @param {SVGElement} svgElement - SVG DOMè¦ç´ 
         * @returns {SVGElement} PDFç”¨ã«èª¿æ•´ã•ã‚ŒãŸSVG DOMè¦ç´ 
         */
        function convertSvgForPdf(svgElement) {
            // dominant-baselineã‚’æŒã¤textè¦ç´ ã‚’æ¤œç´¢
            const textElements = svgElement.querySelectorAll('text[dominant-baseline]');
            
            textElements.forEach(textEl => {
                const baseline = textEl.getAttribute('dominant-baseline');
                const fontSize = parseFloat(textEl.getAttribute('font-size')) || 16;
                let currentY = parseFloat(textEl.getAttribute('y')) || 0;
                
                // text-before-edge: ãƒ†ã‚­ã‚¹ãƒˆä¸Šç«¯ã‚’yåº§æ¨™ã«é…ç½®ï¼ˆSVGæ¨™æº–ï¼‰
                // â†’ svg2pdf.jsã¯ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³åŸºæº–ãªã®ã§ã€yåº§æ¨™ã‚’ä¸‹ã«è£œæ­£
                if (baseline === 'text-before-edge') {
                    const adjustedY = currentY + (fontSize * 0.85);
                    textEl.setAttribute('y', adjustedY.toFixed(2));
                    addLog(`ãƒ†ã‚­ã‚¹ãƒˆä½ç½®èª¿æ•´: y=${currentY} â†’ ${adjustedY.toFixed(2)} (font-size=${fontSize})`);
                }
                else if (baseline === 'central' || baseline === 'middle') {
                    const adjustedY = currentY + (fontSize * 0.35);
                    textEl.setAttribute('y', adjustedY.toFixed(2));
                }
                else if (baseline === 'hanging') {
                    const adjustedY = currentY + (fontSize * 0.80);
                    textEl.setAttribute('y', adjustedY.toFixed(2));
                }
                
                // svg2pdf.jsãŒèªè­˜ã—ãªã„å±æ€§ã‚’å‰Šé™¤
                textEl.removeAttribute('dominant-baseline');
            });
            
            // alignment-baselineã‚‚åŒæ§˜ã«å‡¦ç†
            const alignTextElements = svgElement.querySelectorAll('text[alignment-baseline]');
            alignTextElements.forEach(textEl => {
                const baseline = textEl.getAttribute('alignment-baseline');
                const fontSize = parseFloat(textEl.getAttribute('font-size')) || 16;
                let currentY = parseFloat(textEl.getAttribute('y')) || 0;
                
                if (baseline === 'text-before-edge' || baseline === 'before-edge') {
                    const adjustedY = currentY + (fontSize * 0.85);
                    textEl.setAttribute('y', adjustedY.toFixed(2));
                }
                
                textEl.removeAttribute('alignment-baseline');
            });
            
            return svgElement;
        }

        /**
         * 1æ¬¡å…ƒãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’PDFã«å‡ºåŠ›ã—ã€çµæœé ˜åŸŸã«è¡¨ç¤º
         * @param {string} barcodeResult - ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”»åƒãƒ‡ãƒ¼ã‚¿ï¼ˆBase64 PNG ã¾ãŸã¯ SVGæ–‡å­—åˆ—ï¼‰
         * @param {string} outputFormat - 'png' ã¾ãŸã¯ 'svg'
         * @param {number} widthPx - ãƒãƒ¼ã‚³ãƒ¼ãƒ‰å¹…ï¼ˆpxï¼‰
         * @param {number} heightPx - ãƒãƒ¼ã‚³ãƒ¼ãƒ‰é«˜ã•ï¼ˆpxï¼‰
         * @param {number} rotateAngle - å›è»¢è§’åº¦ï¼ˆ0, 90, 180, 270ï¼‰
         * @param {number} xPx - Xåº§æ¨™ï¼ˆpxï¼‰
         * @param {number} yPx - Yåº§æ¨™ï¼ˆpxï¼‰
         */
        async function generatePDF1D(barcodeResult, outputFormat, widthPx, heightPx, rotateAngle = 0, xPx = 20, yPx = 20) {
            addLog('PDFç”Ÿæˆé–‹å§‹ï¼ˆjsPDF + svg2pdf.js ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä½¿ç”¨ï¼‰...');
            addLog(`å›è»¢è§’åº¦: ${rotateAngle}Â°`);

            // px â†’ mm è‡ªå‹•æ›ç®—
            const x = pxToMm(xPx);
            const y = pxToMm(yPx);
            addLog(`åº§æ¨™æ›ç®—: (${xPx}, ${yPx})px â†’ (${x.toFixed(1)}, ${y.toFixed(1)})mm`);

            // px â†’ mm è‡ªå‹•æ›ç®—
            const widthMM = pxToMm(widthPx);
            const heightMM = pxToMm(heightPx);
            addLog(`ã‚µã‚¤ã‚ºæ›ç®—: ${widthPx}x${heightPx}px â†’ ${widthMM.toFixed(1)}x${heightMM.toFixed(1)}mm`);

            // å›è»¢æ™‚ã®ã‚µã‚¤ã‚ºè¨ˆç®—ï¼ˆ90Â°/270Â°ã§ã¯å¹…ã¨é«˜ã•ãŒå…¥ã‚Œæ›¿ã‚ã‚‹ï¼‰
            const isRotated90or270 = (rotateAngle === 90 || rotateAngle === 270);
            const finalWidthMM = isRotated90or270 ? heightMM : widthMM;
            const finalHeightMM = isRotated90or270 ? widthMM : heightMM;

            // jsPDFã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆï¼ˆA4å›ºå®šï¼‰
            const pdf = new jsPDF({
                orientation: 'portrait',
                unit: 'mm',
                format: 'a4'
            });

            if (outputFormat === 'svg') {
                // SVGå½¢å¼: CanvasçµŒç”±ã§PNGåŒ–ã—ã¦ã‹ã‚‰PDFå‡ºåŠ›
                // â€»svg2pdf.jsã¯ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã®ç´°ã‹ã„ãƒãƒ¼ï¼ˆrectè¦ç´ ï¼‰ã‚’æ­£ç¢ºã«å‡¦ç†ã§ããªã„ãŸã‚ã€
                //   ãƒ™ã‚¯ã‚¿ãƒ¼å½¢å¼ã§ã¯ãªãCanvasçµŒç”±ã§ãƒ©ã‚¹ã‚¿ãƒ©ã‚¤ã‚ºã—ã¦ã‹ã‚‰å‡ºåŠ›ã™ã‚‹
                addLog('SVGå½¢å¼ã‚’CanvasçµŒç”±ã§PDFã«å¤‰æ›ä¸­...');
                try {
                    const svgElement = createSvgElement(barcodeResult);
                    
                    // SVGã‚’ç”»åƒã«å¤‰æ›
                    const svgData = new XMLSerializer().serializeToString(svgElement);
                    const svgBlob = new Blob([svgData], {type: 'image/svg+xml;charset=utf-8'});
                    const svgUrl = URL.createObjectURL(svgBlob);
                    
                    const img = new Image();
                    img.src = svgUrl;
                    await new Promise((resolve, reject) => {
                        img.onload = resolve;
                        img.onerror = reject;
                    });
                    
                    // Canvasä½œæˆï¼ˆé«˜è§£åƒåº¦ã§æç”»ï¼‰
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // å›è»¢å¾Œã®Canvasã‚µã‚¤ã‚ºã‚’è¨­å®š
                    if (isRotated90or270) {
                        canvas.width = img.height;
                        canvas.height = img.width;
                    } else {
                        canvas.width = img.width;
                        canvas.height = img.height;
                    }
                    
                    ctx.fillStyle = 'white';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    // å›è»¢å‡¦ç†ï¼ˆå·¦ä¸‹ã‚’è»¸ã«æ™‚è¨ˆå›ã‚Šï¼‰
                    ctx.save();
                    if (rotateAngle === 90) {
                        ctx.translate(img.height, 0);
                        ctx.rotate(90 * Math.PI / 180);
                    } else if (rotateAngle === 180) {
                        ctx.translate(img.width, img.height);
                        ctx.rotate(180 * Math.PI / 180);
                    } else if (rotateAngle === 270) {
                        ctx.translate(0, img.width);
                        ctx.rotate(270 * Math.PI / 180);
                    }
                    ctx.drawImage(img, 0, 0);
                    ctx.restore();
                    
                    URL.revokeObjectURL(svgUrl);
                    
                    const pngImage = canvas.toDataURL('image/png');
                    pdf.addImage(pngImage, 'PNG', x, y, finalWidthMM, finalHeightMM);
                    addLog(`âœ… SVGâ†’PNGå¤‰æ›å¾Œã€PDFã«è¿½åŠ ï¼ˆå›è»¢: ${rotateAngle}Â°ï¼‰`);
                } catch (error) {
                    addLog(`âŒ SVGâ†’PDFå¤‰æ›ã‚¨ãƒ©ãƒ¼: ${error.message}`, true);
                    return;
                }
            } else {
                // PNGå½¢å¼: Canvasã§å›è»¢ã—ã¦ã‹ã‚‰addImageã‚’ä½¿ç”¨
                if (rotateAngle !== 0) {
                    // å›è»¢ç”¨Canvasã‚’ä½œæˆ
                    const img = new Image();
                    img.src = barcodeResult;
                    await new Promise(resolve => { img.onload = resolve; });
                    
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // å›è»¢å¾Œã®Canvasã‚µã‚¤ã‚ºã‚’è¨­å®š
                    if (isRotated90or270) {
                        canvas.width = img.height;
                        canvas.height = img.width;
                    } else {
                        canvas.width = img.width;
                        canvas.height = img.height;
                    }
                    
                    ctx.fillStyle = 'white';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    // å·¦ä¸‹ã‚’è»¸ã«å›è»¢
                    ctx.save();
                    if (rotateAngle === 90) {
                        ctx.translate(img.height, 0);
                        ctx.rotate(90 * Math.PI / 180);
                    } else if (rotateAngle === 180) {
                        ctx.translate(img.width, img.height);
                        ctx.rotate(180 * Math.PI / 180);
                    } else if (rotateAngle === 270) {
                        ctx.translate(0, img.width);
                        ctx.rotate(270 * Math.PI / 180);
                    }
                    ctx.drawImage(img, 0, 0);
                    ctx.restore();
                    
                    const rotatedImage = canvas.toDataURL('image/png');
                    pdf.addImage(rotatedImage, 'PNG', x, y, finalWidthMM, finalHeightMM);
                    addLog(`âœ… PNGç”»åƒï¼ˆ${rotateAngle}Â°å›è»¢ï¼‰ã‚’PDFã«è¿½åŠ `);
                } else {
                    pdf.addImage(barcodeResult, 'PNG', x, y, widthMM, heightMM);
                    addLog(`âœ… PNGç”»åƒã‚’PDFã«è¿½åŠ `);
                }
            }

            addLog(`ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚µã‚¤ã‚º: ${finalWidthMM.toFixed(1)}x${finalHeightMM.toFixed(1)}mm at (${x.toFixed(1)}, ${y.toFixed(1)})mm`);

            // PDFã‚’BlobURLã¨ã—ã¦å–å¾—ã—ã€çµ±ä¸€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã§è¡¨ç¤º
            const pdfBlobUrl = pdf.output('bloburl');
            const formatLabel = outputFormat === 'svg' ? 'SVGãƒ™ã‚¯ã‚¿ãƒ¼' : 'PNGç”»åƒ';
            
            document.getElementById('result').innerHTML = 
                `<div class="toolbar">
                    <span class="format-label" style="color: #9c27b0;">ğŸ“„ PDFå‡ºåŠ›ï¼ˆ${formatLabel}åŸ‹ã‚è¾¼ã¿ï¼‰</span>
                    <a href="${pdfBlobUrl}" download="barcode.pdf" class="action-btn download">ğŸ’¾ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>
                    <button class="action-btn open-tab" onclick="window.open('${pdfBlobUrl}', '_blank')">ğŸ”— åˆ¥ã‚¿ãƒ–ã§é–‹ã</button>
                    <span class="info-text">ã‚µã‚¤ã‚º: ${widthPx}x${heightPx}px | ä½ç½®: (${xPx}, ${yPx}) | å›è»¢: ${rotateAngle}Â°</span>
                </div>
                <iframe src="${pdfBlobUrl}" width="100%" height="500" style="border: 2px solid #9c27b0; border-radius: 8px;"></iframe>`;

            addLog('âœ… PDFç”Ÿæˆå®Œäº†ã€çµæœé ˜åŸŸã«è¡¨ç¤º');
        }

        /**
         * 2æ¬¡å…ƒãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’PDFã«å‡ºåŠ›ã—ã€çµæœé ˜åŸŸã«è¡¨ç¤º
         * @param {string} barcodeResult - ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”»åƒãƒ‡ãƒ¼ã‚¿ï¼ˆBase64 PNG ã¾ãŸã¯ SVGæ–‡å­—åˆ—ï¼‰
         * @param {string} outputFormat - 'png' ã¾ãŸã¯ 'svg'
         * @param {number} sizePx - ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚µã‚¤ã‚ºï¼ˆpxï¼‰
         * @param {number} rotateAngle - å›è»¢è§’åº¦ï¼ˆ0, 90, 180, 270ï¼‰
         * @param {number} xPx - Xåº§æ¨™ï¼ˆpxï¼‰
         * @param {number} yPx - Yåº§æ¨™ï¼ˆpxï¼‰
         */
        async function generatePDF2D(barcodeResult, outputFormat, sizePx, rotateAngle = 0, xPx = 20, yPx = 20) {
            addLog('PDFç”Ÿæˆé–‹å§‹ï¼ˆjsPDF + svg2pdf.js ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä½¿ç”¨ï¼‰...');
            addLog(`å›è»¢è§’åº¦: ${rotateAngle}Â°`);

            // px â†’ mm è‡ªå‹•æ›ç®—
            const x = pxToMm(xPx);
            const y = pxToMm(yPx);
            addLog(`åº§æ¨™æ›ç®—: (${xPx}, ${yPx})px â†’ (${x.toFixed(1)}, ${y.toFixed(1)})mm`);

            // px â†’ mm è‡ªå‹•æ›ç®—
            const sizeMM = pxToMm(sizePx);
            addLog(`ã‚µã‚¤ã‚ºæ›ç®—: ${sizePx}px â†’ ${sizeMM.toFixed(1)}mm`);

            // jsPDFã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆï¼ˆA4å›ºå®šï¼‰
            const pdf = new jsPDF({
                orientation: 'portrait',
                unit: 'mm',
                format: 'a4'
            });

            if (outputFormat === 'svg') {
                // SVGå½¢å¼: CanvasçµŒç”±ã§PNGåŒ–ã—ã¦ã‹ã‚‰PDFå‡ºåŠ›
                // â€»svg2pdf.jsã¯ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã®ç´°ã‹ã„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆrectè¦ç´ ï¼‰ã‚’æ­£ç¢ºã«å‡¦ç†ã§ããªã„ãŸã‚ã€
                //   ãƒ™ã‚¯ã‚¿ãƒ¼å½¢å¼ã§ã¯ãªãCanvasçµŒç”±ã§ãƒ©ã‚¹ã‚¿ãƒ©ã‚¤ã‚ºã—ã¦ã‹ã‚‰å‡ºåŠ›ã™ã‚‹
                addLog('SVGå½¢å¼ã‚’CanvasçµŒç”±ã§PDFã«å¤‰æ›ä¸­...');
                try {
                    const svgElement = createSvgElement(barcodeResult);
                    
                    // SVGã‚’ç”»åƒã«å¤‰æ›
                    const svgData = new XMLSerializer().serializeToString(svgElement);
                    const svgBlob = new Blob([svgData], {type: 'image/svg+xml;charset=utf-8'});
                    const svgUrl = URL.createObjectURL(svgBlob);
                    
                    const img = new Image();
                    img.src = svgUrl;
                    await new Promise((resolve, reject) => {
                        img.onload = resolve;
                        img.onerror = reject;
                    });
                    
                    // Canvasä½œæˆï¼ˆé«˜è§£åƒåº¦ã§æç”»ï¼‰
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = img.width;
                    canvas.height = img.height;
                    
                    ctx.fillStyle = 'white';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    // å›è»¢å‡¦ç†ï¼ˆå·¦ä¸‹ã‚’è»¸ã«æ™‚è¨ˆå›ã‚Šï¼‰
                    ctx.save();
                    if (rotateAngle === 90) {
                        ctx.translate(img.height, 0);
                        ctx.rotate(90 * Math.PI / 180);
                    } else if (rotateAngle === 180) {
                        ctx.translate(img.width, img.height);
                        ctx.rotate(180 * Math.PI / 180);
                    } else if (rotateAngle === 270) {
                        ctx.translate(0, img.width);
                        ctx.rotate(270 * Math.PI / 180);
                    }
                    ctx.drawImage(img, 0, 0);
                    ctx.restore();
                    
                    URL.revokeObjectURL(svgUrl);
                    
                    const pngImage = canvas.toDataURL('image/png');
                    pdf.addImage(pngImage, 'PNG', x, y, sizeMM, sizeMM);
                    addLog(`âœ… SVGâ†’PNGå¤‰æ›å¾Œã€PDFã«è¿½åŠ ï¼ˆå›è»¢: ${rotateAngle}Â°ï¼‰`);
                } catch (error) {
                    addLog(`âŒ SVGâ†’PDFå¤‰æ›ã‚¨ãƒ©ãƒ¼: ${error.message}`, true);
                    return;
                }
            } else {
                // PNGå½¢å¼: Canvasã§å›è»¢ã—ã¦ã‹ã‚‰addImageã‚’ä½¿ç”¨
                if (rotateAngle !== 0) {
                    const img = new Image();
                    img.src = barcodeResult;
                    await new Promise(resolve => { img.onload = resolve; });
                    
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = img.width;
                    canvas.height = img.height;
                    
                    ctx.fillStyle = 'white';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    // å·¦ä¸‹ã‚’è»¸ã«å›è»¢
                    ctx.save();
                    if (rotateAngle === 90) {
                        ctx.translate(img.height, 0);
                        ctx.rotate(90 * Math.PI / 180);
                    } else if (rotateAngle === 180) {
                        ctx.translate(img.width, img.height);
                        ctx.rotate(180 * Math.PI / 180);
                    } else if (rotateAngle === 270) {
                        ctx.translate(0, img.width);
                        ctx.rotate(270 * Math.PI / 180);
                    }
                    ctx.drawImage(img, 0, 0);
                    ctx.restore();
                    
                    const rotatedImage = canvas.toDataURL('image/png');
                    pdf.addImage(rotatedImage, 'PNG', x, y, sizeMM, sizeMM);
                    addLog(`âœ… PNGç”»åƒï¼ˆ${rotateAngle}Â°å›è»¢ï¼‰ã‚’PDFã«è¿½åŠ `);
                } else {
                    pdf.addImage(barcodeResult, 'PNG', x, y, sizeMM, sizeMM);
                    addLog(`âœ… PNGç”»åƒã‚’PDFã«è¿½åŠ `);
                }
            }

            addLog(`ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚µã‚¤ã‚º: ${sizeMM.toFixed(1)}x${sizeMM.toFixed(1)}mm at (${x.toFixed(1)}, ${y.toFixed(1)})mm`);

            // PDFã‚’BlobURLã¨ã—ã¦å–å¾—ã—ã€çµ±ä¸€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã§è¡¨ç¤º
            const pdfBlobUrl = pdf.output('bloburl');
            const formatLabel = outputFormat === 'svg' ? 'SVGãƒ™ã‚¯ã‚¿ãƒ¼' : 'PNGç”»åƒ';
            
            document.getElementById('result').innerHTML = 
                `<div class="toolbar">
                    <span class="format-label" style="color: #9c27b0;">ğŸ“„ PDFå‡ºåŠ›ï¼ˆ${formatLabel}åŸ‹ã‚è¾¼ã¿ï¼‰</span>
                    <a href="${pdfBlobUrl}" download="barcode.pdf" class="action-btn download">ğŸ’¾ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>
                    <button class="action-btn open-tab" onclick="window.open('${pdfBlobUrl}', '_blank')">ğŸ”— åˆ¥ã‚¿ãƒ–ã§é–‹ã</button>
                    <span class="info-text">ã‚µã‚¤ã‚º: ${sizePx}x${sizePx}px | ä½ç½®: (${xPx}, ${yPx}) | å›è»¢: ${rotateAngle}Â°</span>
                </div>
                <iframe src="${pdfBlobUrl}" width="100%" height="500" style="border: 2px solid #9c27b0; border-radius: 8px;"></iframe>`;

            addLog('âœ… PDFç”Ÿæˆå®Œäº†ã€çµæœé ˜åŸŸã«è¡¨ç¤º');
        }
    </script>
</body>
</html>